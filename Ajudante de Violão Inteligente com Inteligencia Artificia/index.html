<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajudante de Violão Inteligente com IA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #8B4513; /* Marrom escuro */
            --secondary-color: #A0522D; /* Marrom médio */
            --accent-color: #CD853F; /* Marrom claro */
            --light-accent: #DEB887; /* Bege */
            --dark-text: #442C1E; /* Marrom muito escuro para texto */
            --light-text: #FFF8E1; /* Texto claro */
            --bg-light: #FAF0E6; /* Fundo claro */
            --border-color: #D3C1AE;
            --shadow: 0 5px 15px rgba(139, 69, 19, 0.15);
            --radius: 8px;
            --transition: all 0.3s ease;
            --bg-gradient: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--dark-text);
            background-color: var(--bg-light);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px; /* Added padding for container */
        }
        
        header {
            background: var(--bg-gradient);
            color: var(--light-text);
            padding: 3rem 1rem; /* Adjusted padding */
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-bottom: 5px solid var(--accent-color);
        }
        
        /* Removed header::before for cleaner look */
        
        header h1 {
            font-family: 'Poppins', sans-serif; /* Changed font */
            font-weight: 700;
            font-size: 2.5rem; /* Adjusted size */
            margin-bottom: 1rem; /* Adjusted margin */
            position: relative;
            z-index: 1;
        }
        
        .hero-text {
            font-size: 1.1rem; /* Adjusted size */
            max-width: 700px;
            margin: 0 auto 2rem; /* Adjusted margin */
            position: relative;
            z-index: 1;
            opacity: 0.9;
        }
        
        .hero-cta {
            position: relative;
            z-index: 1;
        }
        
        main {
            padding: 40px 0; /* Adjusted padding */
        }
        
        section {
            margin-bottom: 40px; /* Adjusted margin */
            background-color: #fff;
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
        }
        
        h2 {
            font-family: 'Poppins', sans-serif; /* Changed font */
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.8rem; /* Adjusted size */
            margin-bottom: 1.5rem; /* Adjusted margin */
            text-align: left; /* Align left */
            position: relative;
            padding-bottom: 10px; /* Adjusted padding */
            border-bottom: 2px solid var(--border-color); /* Add border bottom */
        }
        
        h2 i {
            margin-right: 10px;
            color: var(--secondary-color);
        }

        /* Removed h2::after */

        .ai-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: flex-start;
        }

        .camera-area, .feedback-area {
            background: var(--bg-light);
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }
        
        .camera-area h3, .feedback-area h3, #exercise-section h3, #chat-section h3 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
        }
        
        .camera-area h3 i, .feedback-area h3 i, #exercise-section h3 i, #chat-section h3 i {
            margin-right: 8px;
        }

        #cameraFeed {
            width: 100%;
            height: auto;
            background-color: #333;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            aspect-ratio: 16 / 9; /* Maintain aspect ratio */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #777;
        }
        
        #feedbackArea {
            min-height: 200px; /* Ensure minimum height */
            background-color: #fff;
            padding: 1rem;
            border-radius: var(--radius);
            border: 1px dashed var(--border-color);
            font-size: 0.95rem;
            overflow-y: auto; /* Add scroll if content overflows */
        }
        
        .feedback-item {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .feedback-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .feedback-item.positive { color: #2E7D32; }
        .feedback-item.negative { color: #B22222; }
        .feedback-item strong { color: var(--dark-text); }

        #exercise-section ul {
            list-style: none;
            padding: 0;
        }
        
        #exercise-section li {
            background: var(--bg-light);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: var(--radius);
            border-left: 4px solid var(--accent-color);
            font-size: 0.95rem;
        }
        
        #chat-section {
            margin-top: 30px;
        }

        /* Styles for Suggested Questions */
        #suggestedQuestions {
            padding: 1rem 1rem 0.5rem 1rem; /* Add padding */
            background-color: #fff; /* Match input area background */
            border: 1px solid var(--border-color);
            border-bottom: none; /* Remove bottom border to merge with input area */
            border-top-left-radius: var(--radius);
            border-top-right-radius: var(--radius);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        #suggestedQuestions h4 {
            width: 100%;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--secondary-color);
            font-weight: 500;
        }

        .suggested-question-btn {
            background-color: var(--bg-light);
            border: 1px solid var(--border-color);
            color: var(--dark-text);
            padding: 6px 12px;
            border-radius: 20px; /* Pill shape */
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .suggested-question-btn:hover {
            background-color: var(--light-accent);
            border-color: var(--secondary-color);
            transform: translateY(-1px);
        }
        /* End Styles for Suggested Questions */

        #chatInterface {
            display: flex;
            flex-direction: column;
            height: 400px; /* Fixed height for chat */
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            overflow: hidden;
            background-color: #fff;
            /* Remove top border radius if suggested questions are added */
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }
        
        #chatMessages {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            background-color: var(--bg-light);
        }
        
        .message {
            margin-bottom: 1rem;
            padding: 0.8rem 1rem;
            border-radius: var(--radius);
            max-width: 80%;
        }
        
        .message.user {
            background-color: var(--accent-color);
            color: var(--dark-text);
            margin-left: auto;
            text-align: right;
        }
        
        .message.ai {
            background-color: #fff;
            border: 1px solid var(--border-color);
            color: var(--dark-text);
            margin-right: auto;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .message.ai i {
            color: var(--primary-color);
            margin-top: 3px;
        }
        
        #inputArea {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            background-color: #fff;
        }
        
        #userInput {
            flex-grow: 1;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-right: 10px;
            font-size: 1rem;
        }
        
        .btn {
            background: var(--primary-color);
            color: var(--light-text);
            padding: 0.8rem 1.5rem; /* Adjusted padding */
            border-radius: var(--radius); /* Adjusted radius */
            text-decoration: none;
            display: inline-flex; /* Use flex for icon alignment */
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 1rem; /* Adjusted size */
            transition: var(--transition);
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
            gap: 8px; /* Space between icon and text */
        }
        
        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-secondary {
            background-color: var(--accent-color);
            color: var(--dark-text);
        }
        .btn-secondary:hover {
            background-color: var(--light-accent);
        }
        
        footer {
            background-color: var(--primary-color);
            color: var(--light-text);
            text-align: center;
            padding: 1.5rem 1rem; /* Adjusted padding */
            margin-top: 40px; /* Adjusted margin */
            border-top: 5px solid var(--accent-color);
        }
        
        .home-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: var(--light-text);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: var(--transition);
            z-index: 100;
            border: none;
        }
        
        .home-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.35);
        }
        
        .home-btn i {
            font-size: 24px;
        }
        
        @media (max-width: 992px) {
            .ai-section {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            header {
                padding: 2rem 1rem;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .hero-text {
                font-size: 1rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            section {
                padding: 1.5rem;
            }

            #cameraFeed {
                min-height: 200px; /* Adjust height for smaller screens */
            }
            
            #chatInterface {
                height: 350px;
            }
        }
        
        @media (max-width: 576px) {
            .btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
            }
            #userInput {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-robot"></i> Ajudante de Violão Inteligente</h1>
            <p class="hero-text">Receba feedback em tempo real e acelere seu aprendizado com IA</p>
            <!-- Removed CTA button from header -->
        </div>
    </header>

    <main class="container">


        <section id="exercise-section">
            <h2><i class="fas fa-dumbbell"></i> Exercícios Sugeridos</h2>
            <h3><i class="fas fa-tasks"></i> Com base na análise</h3>
            <ul id="exerciseList">
                <li>Nenhum exercício sugerido ainda. Inicie a análise.</li>
                <!-- Exercise items will be inserted here by JS -->
                <!-- Example:
                <li><strong>Foco: Posição do Polegar Esquerdo.</strong> Pratique o exercício 'Aranha' lentamente, focando em manter o polegar centrado atrás do braço.</li>
                -->
            </ul>
        </section>

        <section id="chat-section">
            <h2><i class="fas fa-comments"></i> Converse com a IA</h2>
            <h3><i class="fas fa-question-circle"></i> Tire suas dúvidas</h3>
            <div id="suggestedQuestions">
                <h4>Experimente perguntar:</h4>
                <!-- Suggested question buttons will be inserted here by JS -->
            </div>
            <div id="chatInterface">
                <div id="chatMessages">
                    <div class="message ai">
                        <i class="fas fa-robot"></i>
                        <span>Olá! Sou seu Ajudante de Violão Inteligente. Como posso ajudar você com seus estudos hoje? Pergunte sobre acordes, ritmos, técnicas, teoria ou peça dicas!</span>
                    </div>
                    <!-- Chat messages will be inserted here by JS -->
                </div>
                <div id="inputArea">
                    <input type="text" id="userInput" placeholder="Digite sua pergunta aqui...">
                    <button id="sendMessageBtn" class="btn"><i class="fas fa-paper-plane"></i> Enviar</button>
                </div>
            </div>
        </section>
    </main>
    
    <footer>
        <div class="container">
            &copy; 2025 Domine o Violao - Todos os direitos reservados
        </div>
    </footer>

    <button class="home-btn" onclick="window.location.href='../index.html'"> <!-- Link to main index.html -->
        <i class="fas fa-home"></i>
    </button>

    <script>
        // Configuração da API Hugging Face (gratuita)
        const HF_API_TOKEN = "hf_seu_token_aqui"; // Substitua pelo seu token gratuito do Hugging Face
        const MODEL_ID = "google/flan-t5-large"; // Modelo gratuito disponível no Hugging Face
        
        // Elementos do DOM
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const userInput = document.getElementById('userInput');
        const chatMessages = document.getElementById('chatMessages');
        const suggestedQuestionsContainer = document.getElementById('suggestedQuestions');

        // Carregar as perguntas sugeridas imediatamente (sem esperar pelo evento DOMContentLoaded)
        populateSuggestedQuestions();

        // Adiciona eventos ao botão de enviar e à entrada de texto
        if (sendMessageBtn) {
            sendMessageBtn.addEventListener('click', handleSendMessage);
        }
        
        if (userInput) {
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleSendMessage();
                }
            });
        }

        // Inicialização - Garantir que tudo é carregado corretamente
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM totalmente carregado");
            
            // Inicializar a interface do chat
            initChatInterface();
        });

        // Inicializa a interface do chat
        function initChatInterface() {
            // Adiciona eventos de clique e tecla Enter para enviar mensagem
            if (sendMessageBtn) {
                sendMessageBtn.addEventListener('click', handleSendMessage);
                console.log("Botão de enviar configurado");
            } else {
                console.error("Botão de enviar não encontrado!");
            }

            if (userInput) {
                userInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleSendMessage();
                    }
                });
                console.log("Campo de entrada configurado");
            } else {
                console.error("Campo de entrada não encontrado!");
            }
        }

        // --- Suggested Questions --- 
        const suggestedQuestionsList = [
            // Acordes básicos
            "Como fazer o acorde de Fá Maior (F)?",
            "Como fazer o acorde B7?",
            "Como tocar o acorde de Sol menor (Gm)?",
            "Quais são os acordes essenciais para iniciantes?",
            "O que significa C7?",
            "Me ensine todos os acordes com sétima",
            "Como fazer acordes suspensos (sus2, sus4)?",
            "Qual a diferença entre acorde maior e menor?",
            "Como fazer o acorde Fá sustenido menor (F#m)?",
            
            // Técnicas de mão esquerda
            "Me dê uma dica para a pestana não falhar.",
            "Como melhorar a velocidade dos dedos?",
            "Como fazer vibrato no violão?",
            "Como fazer um hammer-on?",
            "Como fazer pull-off corretamente?",
            "Truques para trocar acordes mais rápido",
            "Exercícios para fortalecer os dedos da mão esquerda",
            "Como fazer o slide no violão?",
            "Como fazer bend no violão?",
            
            // Técnicas de mão direita
            "Me ensine um dedilhado simples.",
            "Como tocar usando palheta corretamente?",
            "Técnicas de palm muting para iniciantes",
            "Exercício para independência dos dedos",
            "Como fazer rasqueado no violão?",
            "Como fazer o tapping no violão?",
            "Técnica de slap no violão acústico",
            "Como alternar entre batida e dedilhado na mesma música",
            
            // Ritmos
            "Qual o ritmo mais fácil para iniciantes?",
            "Me ensine o ritmo de reggae",
            "Como tocar batida de samba no violão?",
            "Ritmo básico de bossa nova",
            "Como tocar country no violão?",
            "Ritmo de pop rock para violão",
            "Como fazer levadas de funk no violão?",
            "Ritmo de balada romântica",
            
            // Fundamentos e afinação
            "Como afinar o violão?",
            "Quais os nomes das cordas soltas?",
            "Como trocar as cordas do violão?",
            "Como praticar com metrônomo?",
            "Como posicionar corretamente a mão esquerda?",
            "Meus dedos doem muito, o que fazer?",
            "Qual a diferença entre violão de nylon e aço?",
            "Como saber se meu violão precisa de regulagem?",
            
            // Exercícios específicos
            "Me passe um exercício para trocar de C para G.",
            "Como melhorar minhas trocas de acordes?",
            "Exercícios para iniciantes praticarem todos os dias",
            "Como praticar escalas no violão?",
            "Exercícios para agilidade de dedos",
            "Rotina de treino para 30 minutos por dia",
            "Como praticar de forma eficiente?",
            
            // Repertório e performance
            "Músicas fáceis para iniciantes no violão",
            "Como tocar e cantar ao mesmo tempo?",
            "Dicas para tocar bossa nova",
            "Como superar o medo de tocar para outras pessoas?",
            "Como memorizar músicas mais facilmente?",
            
            // Leitura e teoria
            "Como ler uma tablatura?",
            "Explique o campo harmônico de Dó maior",
            "Como entender cifras com números (C9, G13)?",
            "O que são inversões de acordes?",
            "Qual escala usar para improvisar em G?",
            "Como funciona o Ciclo das Quintas?",
            "O que são modos musicais?",
            "Como entender tonalidades no violão?"
        ];

        function populateSuggestedQuestions() {
            // Certifique-se de que o container existe antes de tentar preenchê-lo
            if (!suggestedQuestionsContainer) {
                console.error("Container de perguntas sugeridas não encontrado");
                return;
            }
            
            suggestedQuestionsContainer.innerHTML = '<h4>Experimente perguntar:</h4>';
            
            // Selecione 8 perguntas aleatórias para não sobrecarregar a interface
            const randomQuestions = [];
            const totalQuestions = suggestedQuestionsList.length;
            const numberOfQuestionsToShow = Math.min(8, totalQuestions);
            
            // Seleciona perguntas aleatórias sem repetir
            while (randomQuestions.length < numberOfQuestionsToShow) {
                const randomIndex = Math.floor(Math.random() * totalQuestions);
                const question = suggestedQuestionsList[randomIndex];
                if (!randomQuestions.includes(question)) {
                    randomQuestions.push(question);
                }
            }
            
            // Adiciona as perguntas selecionadas ao container
            randomQuestions.forEach(question => {
                const button = document.createElement('button');
                button.classList.add('suggested-question-btn');
                button.textContent = question;
                button.addEventListener('click', () => {
                    userInput.value = question;
                    handleSendMessage(); // Envia a mensagem imediatamente após clicar na sugestão
                });
                suggestedQuestionsContainer.appendChild(button);
            });
        }

        // --- Chat Logic ---
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender); // sender is 'user' or 'ai'
            
            if (sender === 'ai') {
                const icon = document.createElement('i');
                icon.className = 'fas fa-robot';
                messageDiv.appendChild(icon);
                const span = document.createElement('span');
                // Substituindo \n por <br> para preservar quebras de linha
                span.innerHTML = text.replace(/\n/g, '<br>');
                messageDiv.appendChild(span);
            } else {
                messageDiv.textContent = text;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom
        }

        // Adiciona um indicador de carregamento enquanto espera resposta da IA
        function showLoadingIndicator() {
            const loadingDiv = document.createElement('div');
            loadingDiv.classList.add('message', 'ai', 'loading');
            loadingDiv.id = 'loading-message';
            
            const icon = document.createElement('i');
            icon.className = 'fas fa-robot';
            loadingDiv.appendChild(icon);
            
            const span = document.createElement('span');
            span.textContent = "Pensando...";
            loadingDiv.appendChild(span);
            
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeLoadingIndicator() {
            const loadingElement = document.getElementById('loading-message');
            if (loadingElement) {
                loadingElement.remove();
            }
        }
        
        // Função para obter resposta da Hugging Face API (gratuita)
        async function getAIResponse(prompt) {
            try {
                // Verifica se estamos em modo de demonstração ou se o token não foi configurado
                if (!HF_API_TOKEN || HF_API_TOKEN === "hf_seu_token_aqui") {
                    console.warn("Token da API Hugging Face não configurado. Usando respostas pré-definidas.");
                    // Adiciona um pequeno delay para simular o pensamento da IA
                    await new Promise(resolve => setTimeout(resolve, 500));
                    return getFallbackResponse(prompt);
                }

                // Cria um contexto específico para violão - Refinado
                const fullPrompt = `Você é o 'Mestre das Cordas', um professor de violão experiente, amigável e muito paciente. Responda à seguinte pergunta de um aluno de forma clara, didática, passo a passo e encorajadora. Sempre que possível, inclua:
1.  Uma explicação conceitual simples.
2.  Instruções práticas e detalhadas (posicionamento dos dedos, movimentos).
3.  Um pequeno exercício prático relacionado à pergunta, com instruções claras.
4.  Uma dica extra ou um conselho motivacional.

Pergunta do aluno: "${prompt}"

Resposta do Mestre das Cordas:`;

                const response = await fetch(`https://api-inference.huggingface.co/models/${MODEL_ID}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${HF_API_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: fullPrompt,
                        parameters: {
                            max_new_tokens: 300, // Aumentado para respostas mais completas
                            temperature: 0.75, // Um pouco mais criativo
                            top_p: 0.9,
                            repetition_penalty: 1.1 // Evitar repetições
                        }
                    })
                });
                
                const result = await response.json();
                
                if (result && result[0] && result[0].generated_text) {
                    // Limpeza da resposta - remove o prompt da resposta e outros ruídos
                    let cleanResponse = result[0].generated_text.replace(fullPrompt, '').trim();
                    // Remove possíveis repetições do início da resposta
                    if (cleanResponse.toLowerCase().startsWith(prompt.toLowerCase().substring(0, 10))) {
                         cleanResponse = cleanResponse.substring(prompt.length).trim();
                    }
                    return cleanResponse || getFallbackResponse(prompt); // Usa fallback se a resposta limpa for vazia
                } else if (result.error) {
                    console.error("Erro na API Hugging Face:", result.error);
                    return `Desculpe, tive um problema (${result.error}). Vamos tentar uma resposta local: ${getFallbackResponse(prompt)}`;
                } else {
                    console.error("Formato de resposta inesperado da Hugging Face:", result);
                    return getFallbackResponse(prompt);
                }
            } catch (error) {
                console.error("Erro ao conectar com a API Hugging Face:", error);
                return `Não consegui conectar ao meu cérebro principal! 🧠 Mas posso tentar ajudar com informações locais: ${getFallbackResponse(prompt)}`;
            }
        }
        
        // Respostas pré-definidas (Fallback) - Melhoradas e mais detalhadas
        function getFallbackResponse(messageText) {
            let aiResponse = "Desculpe, não entendi bem. Pode reformular sua pergunta sobre violão? Estou aqui para ajudar com afinação, acordes, ritmos, técnicas, teoria musical, leitura de cifras/tablaturas ou dicas gerais!";

            messageText = messageText.toLowerCase();

            // Pestana / F Chord
            if (messageText.includes("pestana") || messageText.includes("fá maior") || messageText.includes("acorde f")) {
                aiResponse = `Ah, a famosa pestana! É um desafio, mas você consegue! 💪\n\n**Para o Fá Maior (F):**\n1.  **Dedo 1 (Indicador):** Pressione TODAS as 6 cordas na 1ª casa (essa é a pestana).\n2.  **Dedo 2 (Médio):** Na 2ª casa da corda G (3ª corda).\n3.  **Dedo 3 (Anelar):** Na 3ª casa da corda A (5ª corda).\n4.  **Dedo 4 (Mínimo):** Na 3ª casa da corda D (4ª corda).\n\n**Dicas Cruciais:**\n*   **Posição do Indicador:** Coloque o dedo indicador um pouco de lado, usando a parte mais 'óssea' para pressionar, não a parte 'mole' da digital.\n*   **Polegar Oposto:** O polegar da mão esquerda deve estar posicionado atrás do braço, quase no meio, aplicando contra-pressão.\n*   **Altura do Pulso:** Mantenha o pulso elevado e o antebraço mais alinhado com o braço do violão.\n*   **Distância do Traste:** A pestana deve estar bem próxima ao traste de metal (sem estar em cima dele).\n\n**Exercícios Progressivos para Dominar a Pestana:**\n\n**Exercício 1: Pestana Parcial**\n- Faça pestana apenas nas primeiras 3 cordas (mais finas) na 1ª casa\n- Toque uma corda de cada vez, garantindo som limpo\n- Faça 5 séries de 10 segundos seguradas, com 5 segundos de descanso\n\n**Exercício 2: Pestana Vazia**\n- Faça pestana completa na 1ª casa (todas as 6 cordas) sem outros dedos\n- Toque cada corda separadamente - identifique onde o som não sai limpo\n- Ajuste a pressão e o ângulo do dedo até melhorar\n\n**Exercício 3: F Simplificado**\n- Tente o acorde F 'curto', apenas nas 4 primeiras cordas\n- Depois que dominar, adicione as outras cordas\n\n**Exercício 4: Progressão de Força**\n- Pratique pestanas em diferentes casas: 1ª, 3ª e 5ª casa\n- A pestana na 1ª casa é mais difícil! Se conseguir nas casas mais altas, volte para a 1ª\n\nLembra que todo mundo passa por isso! Pratique 5-10 minutos por dia e em algumas semanas você verá grande diferença. Não desista!`;
            }
            // Leitura de cifras
            else if (messageText.includes("cifra") || (messageText.includes("ler") && messageText.includes("cifras"))) {
                aiResponse = `**Guia para Leitura de Cifras** 📝\n\n**O Que São Cifras?**\nCifras são uma notação simplificada que indica quais acordes tocar em uma música, normalmente escritas acima da letra.\n\n**Elementos Básicos:**\n\n**1. Letra do Acorde Principal:**\nRepresenta a nota fundamental (C = Dó, D = Ré, E = Mi, F = Fá, G = Sol, A = Lá, B = Si)\n\n**2. Qualidade do Acorde:**\n- **Sem indicação:** Acorde maior (ex: C = Dó maior)\n- **m:** Acorde menor (ex: Am = Lá menor)\n- **7:** Acorde com sétima (ex: G7 = Sol com sétima)\n- **m7:** Acorde menor com sétima (ex: Dm7 = Ré menor com sétima)\n- **maj7:** Acorde maior com sétima maior (ex: Cmaj7 = Dó maior com sétima maior)\n- **dim ou º:** Acorde diminuto (ex: Bº = Si diminuto)\n\n**3. Alterações e Extensões:**\n- **sus4:** Suspensa 4 (ex: Dsus4)\n- **sus2:** Suspensa 2 (ex: Asus2)\n- **add9:** Acorde com nona adicionada (ex: Cadd9)\n- **6:** Acorde com sexta (ex: F6)\n- **9, 11, 13:** Extensões (ex: G9, D11, A13)\n\n**4. Alterações na Fundamental:**\n- **#:** Sustenido (meio tom acima) - ex: F# = Fá sustenido\n- **b:** Bemol (meio tom abaixo) - ex: Bb = Si bemol\n\n**5. Inversões (baixo alternativo):**\n- **C/E:** Acorde de Dó maior com Mi no baixo\n- **Am/G:** Acorde de Lá menor com Sol no baixo\n\n**Como Ler uma Cifra Completa:**\n\n```\nC     Am    F       G7    Dm7b5   Cmaj7/E
↓     ↓      ↓       ↓      ↓         ↓
Dó   Lá     Fá      Sol    Ré        Dó maior com
Maior Menor  Maior   dom.   menor     7ª maior e Mi
               com    7ª    com 7ª    no baixo
               7ª     dim.
                    aiResponse = `**Melhorando as Trocas de Acordes:**\n\nTrocar acordes com fluidez é um dos maiores desafios para violonistas iniciantes. Aqui estão exercícios que realmente funcionam:

**Exercício 1: Técnica da Preparação Antecipada**
1. Escolha dois acordes para praticar (ex: G e C)
2. Monte o primeiro acorde (G) e toque-o quatro vezes
3. Sem tocar as cordas, mova apenas os dedos para a posição do segundo acorde (C)
4. Segure essa posição por 5 segundos, visualizando mentalmente
5. Toque o segundo acorde quatro vezes
6. Repita o processo voltando ao primeiro acorde
7. Execute este exercício lentamente (60 BPM) por 5 minutos

**Exercício 2: Treinamento Intervalado com Metrônomo**
1. Ajuste o metrônomo para 40 BPM
2. Toque o primeiro acorde em um beat
3. Você tem apenas um beat para mudar para o próximo acorde
4. Toque o segundo acorde no beat seguinte
5. Continue alternando: acorde → mudança → acorde → mudança...
6. A chave é manter o tempo constante mesmo que precise fazer pausas
7. Gradualmente aumente a velocidade quando conseguir fazer 10 trocas perfeitas

**Exercício 3: Técnica do Fotograma**
1. Monte o primeiro acorde
2. Remova TODOS os dedos do braço do violão
3. Reposicione TODOS os dedos de volta no primeiro acorde de uma só vez
4. Repita 10 vezes, tentando colocar cada dedo exatamente no lugar certo
5. Faça o mesmo com o segundo acorde
6. Agora alterne: primeiro acorde → remover dedos → segundo acorde → remover dedos...

**Exercício 4: Identificação de Dedos Pivô**
1. Identifique quais dedos permanecem no mesmo lugar (ou quase) na transição
2. Mantenha esses "dedos pivô" no lugar enquanto move apenas os outros
3. Pratique a transição mantendo contato visual com os dedos pivô
4. Isso cria "âncoras" para facilitar a mudança

**Dica de Ouro:** Sempre pratique transições em contexto musical. Escolha uma progressão simples de uma música real e aplique estes exercícios. Isso torna o treino mais motivador e diretamente aplicável!`;
                }
                return aiResponse; // Return early as this is a specific request
            }
            // Como melhorar velocidade dos dedos
            else if (messageText.includes("velocidade") && (messageText.includes("dedos") || messageText.includes("mão"))) {
                aiResponse = `**Como Melhorar a Velocidade dos Dedos no Violão:**\n\nA velocidade é resultado de movimentos precisos e eficientes, não de força bruta. Aqui está um plano progressivo para desenvolver agilidade nos dedos:

**Fundamentos Essenciais:**
1. **Postura Correta:**
   * Punho levemente curvado, não dobrado
   * Dedos arqueados, como se segurasse uma bola pequena
   * Polegar posicionado no meio do braço do violão (não aparecendo acima do braço)

2. **Movimento Econômico:**
   * Use apenas a pressão necessária (excesso de força = tensão = lentidão)
   * Mantenha os dedos próximos às cordas (1-2 cm no máximo)
   * Levante os dedos apenas o suficiente para mudar de posição

**Programa de Exercícios Progressivos (10 min/dia):**

**Nível 1: Cromático Fundamental (3 min)**
- Em uma única corda, posicione os dedos 1-2-3-4 nas casas consecutivas (ex: casas 1-2-3-4)
- Toque cada nota claramente em sequência, mantendo os outros dedos próximos à corda
- Use metrônomo a 60 BPM, uma nota por batida
- Quando conseguir 5 sequências perfeitas, aumente 5 BPM
- Faça na corda E (1ª), depois B (2ª), etc.

**Nível 2: Aranha (3 min)**
- Dedo 1 na casa 1, corda E (6ª)
- Dedo 2 na casa 2, corda A (5ª)
- Dedo 3 na casa 3, corda D (4ª)
- Dedo 4 na casa 4, corda G (3ª)
- Toque todas as notas, uma por uma
- Depois, mova tudo uma corda acima (casa 1/corda A, casa 2/corda D, etc.)
- Continue subindo até chegar à corda E (1ª)
- Desça de volta à posição inicial

**Nível 3: Saltos Controlados (2 min)**
- Pratique saltos específicos entre cordas/casas
- Exemplo: Dedo 1 na casa 5/corda D, depois salte para casa 2/corda B
- Faça o salto lentamente no início, focando na precisão
- Aumente gradualmente a velocidade
- Crie padrões de saltos que simulem situações reais de música

**Nível 4: Aplicação em Escalas (2 min)**
- Aprenda a escala pentatônica menor na posição 1 (a mais básica)
- Pratique tocando do grave ao agudo e vice-versa
- Use metrônomo e aumente a velocidade gradualmente
- Quando confortável, adicione variações rítmicas (tercinas, quiálteras)

**Dica Profissional:** O segredo para ganhar velocidade é praticar LENTAMENTE com atenção total à economia de movimento. Paradoxal, mas verdadeiro! Pratique com precisão a 60 BPM e você tocará com facilidade a 120 BPM em algumas semanas.

**Exercício Extra: Treinamento de Independência**
- Mantenha o dedo 1 na casa 1/corda E (6ª)
- Tente tocar com o dedo 3 na casa 3/corda E, sem mover o dedo 1
- Depois tente com o dedo 4 na casa 4/corda E, ainda mantendo o dedo 1
- Gradualmente trabalhe diferentes combinações de dedos fixos/móveis

Lembre-se: Não force! Se sentir tensão ou dor, faça pausas frequentes e verifique sua técnica. A fluidez vem antes da velocidade!`;
            }
            // Metrônomo
            else if (messageText.includes("metrônomo") || (messageText.includes("praticar") && messageText.includes("tempo"))) {
                aiResponse = `**Como Praticar com Metrônomo de Forma Eficaz:**\n\nO metrônomo é sua ferramenta mais poderosa para desenvolver precisão rítmica e velocidade controlada. Vamos dominá-lo:

**Por que usar o metrônomo:**
- Desenvolve seu senso de tempo interno
- Expõe inconsistências rítmicas que você não percebe
- Força disciplina técnica e controle
- Oferece uma forma mensurável de acompanhar seu progresso

**Exercícios Progressivos:**

**Fase 1: Estabelecendo Base Rítmica (para iniciantes)**
1. Configure o metrônomo em 70-80 BPM (batidas por minuto)
2. Toque um acorde simples fazendo apenas movimentos para baixo (↓) em cada batida
3. Quando estiver confortável, alterne entre baixo (↓) e cima (↑): ↓↑↓↑
4. Adicione variações: ↓↑↑↓, ↓↓↑↑, etc.
5. Pratique por 5-10 minutos diários

**Fase 2: Subdividindo o Tempo (intermediário)**
1. Configure para 60 BPM
2. Toque o primeiro acorde em um beat
3. Você tem apenas um beat para mudar para o próximo acorde
4. Toque o segundo acorde no beat seguinte
5. Continue alternando: acorde → mudança → acorde → mudança...
6. A chave é manter o tempo constante mesmo que precise fazer pausas
7. Gradualmente aumente a velocidade quando conseguir fazer 10 trocas perfeitas

**Fase 3: Deslocamentos Rítmicos (avançado)**
1. Configure para 50-60 BPM
2. Em vez de tocar NA batida, toque ENTRE as batidas (contra-tempos)
3. Conte "1-e-2-e-3-e-4-e", mas toque apenas nos "e"
4. Tente alternar entre tocar nas batidas e nos contra-tempos
5. Isso desenvolve independência rítmica

**Técnicas de Prática Eficaz:**

**Técnica do Metrônomo Decrescente:**
1. Comece em um andamento onde você consegue tocar perfeitamente (ex: 80 BPM)
2. Toque por 1 minuto nesta velocidade
3. Aumente 5 BPM e toque por 30 segundos
4. Aumente mais 5 BPM e toque por 20 segundos
5. Volte ao andamento inicial - ele parecerá surpreendentemente mais fácil!

**Metrônomo Silencioso:**
1. Ligue o metrônomo e toque junto por 30 segundos
2. Silencie o metrônomo por 4 compassos enquanto continua tocando
3. Ligue novamente para verificar se manteve o tempo
4. Gradualmente aumente o tempo "silencioso"

**Aplicações Práticas:**
- Pratique transições de acordes com o metrônomo em andamento lento
- Use para dominar passagens técnicas difíceis
- Treine leituras de cifra/partitura mantendo o tempo constante

**Dica de Ouro:** Resista à tentação de aumentar o tempo antes de dominar completamente o andamento atual. Sua meta é precisão consistente, não velocidade forçada!

**Apps de Metrônomo Recomendados:** Pro Metronome, Soundbrenner, The Metronome by Musicroom (todos têm versões gratuitas).`;
            }
            
            // Rhythms
            else if (messageText.includes("ritmo") || messageText.includes("batida")) {
                let ritmo = "Pop/Rock básico";
                let desc = "↓ ↓↑ ↓↑ (Baixo, Baixo-Cima, Baixo-Cima)";
                let example = "Comum em muitas músicas pop e rock.";
                
                if (messageText.includes("rock")) {
                    ritmo = "Rock Clássico";
                    desc = "↓ ↓↑ ↑↓↑ (Baixo, Baixo-Cima, Cima-Baixo-Cima)";
                    example = "Ex: Knockin' on Heaven's Door (versão G'n'R)";
                } else if (messageText.includes("reggae")) {
                    ritmo = "Reggae Skank";
                    desc = "(Mudo) ↑ (Mudo) ↑ (Silêncio nos tempos fortes, toque para cima nos contratempos)";
                    example = "Ex: Three Little Birds - Bob Marley";
                } else if (messageText.includes("samba") || messageText.includes("pagode")) {
                    ritmo = "Samba/Pagode Básico";
                    desc = "↓ ↑↓↑ ↓↑ (Baixo, Cima-Baixo-Cima, Baixo-Cima)"; // Simplificado
                    example = "Leva característica, mas simplificado para iniciar.";
                } else if (messageText.includes("balada") || messageText.includes("lenta")) {
                    ritmo = "Balada Simples";
                    desc = "↓ (pausa) ↓↑ (pausa) ↓↑ (Baixo, pausa, Baixo-Cima, pausa, Baixo-Cima)";
                    example = "Ex: Hallelujah - Leonard Cohen";
                } else if (messageText.includes("valsa")) {
                    ritmo = "Valsa (3/4)";
                    desc = "↓ ↑ ↑ (Baixo, Cima, Cima)";
                    example = "Músicas em compasso ternário.";
                } else if (messageText.includes("bossa nova")) {
                    ritmo = "Bossa Nova Básica";
                    desc = "↓ (1) ↑↓ (e) ↑ (2) ↓ (e) ↑↓ (3) ↑ (4)";
                    example = "Ex: Garota de Ipanema - Tom Jobim";
                } else if (messageText.includes("funk")) {
                    ritmo = "Funk Brasileiro Simplificado";
                    desc = "↓↓ ↑↑ ↓↑ ↓↑ (com ênfase nas batidas para cima)";
                    example = "Adapte para músicas de funk mais populares";
                } else if (messageText.includes("country")) {
                    ritmo = "Country Básico";
                    desc = "↓ ↓↑ ↓ ↓↑ (acentuando o baixo nos tempos 1 e 3)";
                    example = "Ex: Take Me Home, Country Roads - John Denver";
                } else if (messageText.includes("fácil") || messageText.includes("iniciante")) {
                     ritmo = "Super Fácil";
                     desc = "↓ ↓ ↓ ↓ (Quatro toques para baixo por acorde)";
                     example = "Ótimo para focar na troca de acordes no início.";
                }

                aiResponse = `**Ritmo: ${ritmo}** 🎵\n\n**Padrão:** ${desc}\n*Exemplo de uso:* ${example}\n\n**Como Praticar este Ritmo:**\n\n**Passo 1: Entenda o Movimento**\n- ↓ = Movimento para baixo (com dedos ou palheta)
- ↑ = Movimento para cima (com dedos ou palheta)
- Pratique os movimentos no ar primeiro, sem tocar as cordas
- Use seu pulso de forma relaxada, não o braço inteiro

**Passo 2: Pratique Sem Acordes**\n- Abafe todas as cordas levemente com a mão esquerda
- Pratique o padrão rítmico puro, sem se preocupar com acordes
- Use metrônomo em 60-70 BPM
- Repita até o movimento ficar automático (5 minutos)

**Passo 3: Adicione Um Acorde Simples**\n- Escolha um acorde fácil (Em ou Am)
- Mantenha o acorde formado enquanto executa o ritmo
- Continue com o metrônomo
- Foque em manter a constância do tempo

**Passo 4: Progressão Simples**\n- Use dois acordes que você domina (ex: Em - Am)
- Toque 4 repetições do ritmo em cada acorde
- Quando estiver confortável, reduza para 2 repetições por acorde
- Pratique a transição suave entre os acordes sem perder o ritmo

**Dica Técnica:** O segredo de um bom ritmo está no pulso relaxado e na precisão do tempo. A força vem do pulso, não dos dedos ou do braço.

**Exercício de Fixação: Isolamento Rítmico**\n1. Grave-se tocando apenas o ritmo por 1 minuto
2. Ouça a gravação e identifique inconsistências
3. Pratique especificamente as partes problemáticas
4. Repita o processo até soar consistente

**Próximo Nível:** Depois de dominar este ritmo básico, experimente adicionar acentos em determinadas batidas ou incluir batidas nas cordas mudas (percussivas) para enriquecer o som.

Quer experimentar outro ritmo ou aprender variações deste?`;
            }
            // Fingerpicking / Dedilhado
            else if (messageText.includes("dedilhado") || messageText.includes("fingerstyle") || messageText.includes("dedos")) {
                aiResponse = `O dedilhado é uma técnica que transforma completamente seu violão! Vamos dominar isso! 🎶\n\n**Nomenclatura dos Dedos da Mão Direita:**\n*   **p** = Polegar (geralmente toca as cordas graves: E, A, D - os 'bordões')\n*   **i** = Indicador (geralmente toca a corda G/3ª)\n*   **m** = Médio (geralmente toca a corda B/2ª)\n*   **a** = Anelar (geralmente toca a corda E aguda/1ª)\n\n**Programa de Exercícios Progressivos:**\n\n**Nível 1 - Independência dos Dedos (5 min por dia)**\n1. **Exercício Básico PIMA:**\n   * Monte um acorde simples como Am ou Em.\n   * Toque a sequência: **p - i - m - a** (uma nota por tempo, 60 BPM).\n   * O polegar (p) toca a 5ª corda (A), indicador (i) toca a 3ª corda (G), médio (m) toca a 2ª corda (B), anelar (a) toca a 1ª corda (E).\n   * Repita 10 vezes mantendo um ritmo constante.\n\n2. **Exercício de Alternância:**\n   * Mesmo acorde, agora toque: **p - i - p - m - p - a** (60 BPM).\n   * O polegar alterna com os outros dedos, criando um padrão de baixo alternado.\n   * Repita 10 vezes sem parar.\n\n**Nível 2 - Arpejos Simples (7 min por dia)**\n1. **Arpejo Simples em C:**\n   * Monte o acorde de Dó (C).\n   * Toque: p(5ª corda) - i(3ª corda) - m(2ª corda) - a(1ª corda) - m(2ª corda) - i(3ª corda)\n   * Repita o padrão fluido, como uma onda.\n\n2. **Arpejo em Am:**\n   * Mude para o acorde de Am sem interromper o ritmo.\n   * Continue o mesmo padrão de dedos.\n   * Alterne entre C e Am a cada 4 repetições do padrão.\n\n**Nível 3 - Travis Picking (Técnica de Country/Folk)**\n1. **Padrão Básico de Travis Picking:**\n   * Com acorde de C: Toque p(5ª) - i(3ª) - p(4ª) - m(2ª)\n   * Mantenha o polegar alternando entre as cordas graves enquanto os outros dedos criam a melodia.\n\n**Dicas Técnicas Essenciais:**\n\n1. **Postura da Mão:**\n   * Mantenha o pulso levemente arqueado, como se estivesse segurando uma laranja.\n   * Dedos curvados e relaxados, nunca rígidos.\n   * Polegar aponta ligeiramente para cima, não paralelo às outras cordas.\n\n2. **Toque com as Pontas:**\n   * Use as pontas dos dedos, não a parte carnuda.\n   * Exceção: o polegar pode usar uma superfície maior para um som mais encorpado.\n\n3. **Preparação dos Dedos:**\n   * Posicione todos os dedos levemente sobre as cordas que irão tocar antes de iniciar.\n   * Isso evita movimentos precipitados e garante precisão.\n\n**Aplicação Prática: "Romanza" (Melodia Simples)**\nExperimente este trecho da famosa música clássica:\n\n* Dedos i-m alternados na 1ª corda: 7-5-3-2-3-5-7-8-7-5-3-2-0\n* Depois, use o polegar para tocar a 3ª corda solta enquanto continua a melodia com i-m.\n\nPratique lentamente, com metrônomo, e aumente a velocidade gradualmente. O segredo do dedilhado é a consistência diária, mesmo que por apenas 5-10 minutos!`;
            }
            
            // Prática Eficiente e Rotinas de Estudo
            if (messageText.includes("praticar") && (messageText.includes("eficiente") || messageText.includes("melhor forma"))) {
                aiResponse = `**Como Praticar Violão de Forma Eficiente:**\n\n**1. Princípio de Prática Deliberada:**\n- **Foco em Dificuldades:** Identifique pontos fracos específicos (uma troca de acorde difícil, um trecho rápido, etc.).
- **Isole o Problema:** Trabalhe em trechos pequenos (3-4 compassos) que contenham a dificuldade.
- **Repetição Consciente:** Faça repetições com atenção total ao movimento, não no "piloto automático".

**2. Estrutura de Prática (Modelo para 30 minutos):**\n- **Aquecimento (5 min):** Exercícios simples de técnica, alongamentos.
- **Revisão (5 min):** Toque algo que já domina bem (reforço positivo).
- **Ponto de Foco Principal (15 min):** Trabalhe intensamente em uma única habilidade.
- **Aplicação Musical (5 min):** Aplique a técnica em uma música ou trecho musical.

**3. Exercícios Práticos para Sessões Curtas:**

**Exercício #1: Prática de Transições em Câmera Lenta**
- Escolha uma transição de acordes difícil (ex: F → C).
- Configure o metrônomo em 40 BPM.
- Toque o primeiro acorde por 4 tempos.
- Use os próximos 4 tempos para mover lentamente os dedos para a posição do segundo acorde.
- Continue alternando, sempre mantendo movimentos suaves e precisos.
- Faça 5 vezes sem erro antes de aumentar o tempo em 5 BPM.

**Exercício #2: Técnica do Microscópio**
1. Selecione um trecho de 2-4 compassos de uma música.
2. Toque em velocidade muito reduzida (30% da velocidade final).
3. Observe conscientemente cada movimento de dedo.
4. A cada repetição bem-sucedida, aumente 10% a velocidade.
5. Ao atingir 70%, volte para 30% e recomece o processo.

**Exercício #3: Treino em Intervalos**
- Pratique por 25 minutos.
- Faça pausa obrigatória de 5 minutos (levante-se, alongue).
- Volte por mais 25 minutos.
- Este método aproveita o "Efeito de Primazia e Recência" - aprendemos mais no início e no final das sessões.

**4. Ferramentas Obrigatórias:**
- **Metrônomo:** Comece lento! Gradualmente aumente a velocidade.
- **Gravação:** Grave seu treino frequentemente e ouça criticamente.
- **Diário de Prática:** Anote o que praticou, velocidade do metrônomo, e desafios.

**Dica Motivacional:** Lembre-se que até os grandes músicos começaram com os mesmos desafios. O segredo não está em sessões longas, mas sim na consistência diária e na prática consciente!`;
            }
            
            // Rotina de treino para tempo específico
            else if ((messageText.includes("rotina") || messageText.includes("treino")) && 
                    (messageText.includes("30 minutos") || messageText.includes("meia hora") || 
                     messageText.includes("15 minutos") || messageText.includes("20 minutos") || messageText.includes("uma hora"))) {
                
                let tempo = "30 minutos";
                if (messageText.includes("15 minutos")) tempo = "15 minutos";
                if (messageText.includes("20 minutos")) tempo = "20 minutos";
                if (messageText.includes("uma hora") || messageText.includes("60 minutos")) tempo = "60 minutos";
                
                if (tempo === "15 minutos") {
                    aiResponse = `**Rotina Eficiente de 15 Minutos Diários:**\n\n**Dias 1, 3, 5 (Foco Técnico)**\n- **Aquecimento (2 min):** Alongamentos de mão e dedos + tocar 1 escala simples.
- **Acordes (6 min):** Trabalhe em 3 acordes por dia. Para cada acorde:
  * Monte, verifique o som de cada corda (1 min)
  * Pratique 10 trocas com outro acorde (1 min)
- **Ritmo (5 min):** Pratique uma única batida com esses acordes.
- **Revisão (2 min):** Toque algo que você já sabe, mesmo que seja simples.

**Dias 2, 4, 6 (Foco Musical)**\n- **Aquecimento (2 min):** Mesmo procedimento.
- **Progressão (5 min):** Pratique uma progressão de 2-3 acordes com ritmo.
- **Trecho de Música (7 min):** Trabalhe em um pequeno trecho de uma música.
- **Diversão (1 min):** Termine improvisando algo livremente.

**Exercício Específico: A Técnica Sanduíche (para qualquer trecho difícil)**\n- Toque o compasso ANTES do trecho difícil
- Toque o trecho difícil LENTAMENTE
- Toque o compasso DEPOIS do trecho difícil
- Repita este "sanduíche" 5 vezes

**Dica Motivacional:** 15 minutos consistentes todos os dias produzem resultados muito melhores que sessões longas ocasionais. Celebre pequenas vitórias diárias!`;
                }
                else if (tempo === "60 minutos") {
                    aiResponse = `**Rotina Completa de 1 Hora de Prática:**\n\n**Estrutura Recomendada:**

**1. Aquecimento (10 min)**
- Alongamentos para mãos e punhos (2 min)
- Exercício "Dedos de Aranha" em todas as cordas (3 min)
- Escalas cromáticas em uma corda (3 min)
- Exercício de independência dos dedos (2 min)

**2. Técnica Fundamental (15 min)**
- **Dias Pares:** Trabalho de Mão Direita
  * Alternância de dedos p-i-m-a em padrões (5 min)
  * Prática de batidas rítmicas específicas (5 min)
  * Exercícios de palhetada alternada (5 min)
- **Dias Ímpares:** Trabalho de Mão Esquerda
  * Exercícios de pestana com metrônomo (5 min)
  * Hammer-ons e pull-offs em sequência (5 min)
  * Exercício de alongamento para dedos 1-3-4 (5 min)

**3. Repertório (25 min)**
- Revisão de música(s) já conhecida(s) (5 min)
- Trabalho em seção nova/difícil (10 min)
- Prática de uma música completa (10 min)

**4. Teoria Aplicada (5 min)**
- **Opções rotativas:**
  * Identificar notas no braço do violão
  * Construir acordes a partir de fórmulas
  * Praticar uma escala em diferentes posições
  * Criar uma progressão de acordes simples

**5. Sessão Livre/Criativa (5 min)**
- Improviso sobre uma progressão simples
- Composição de uma pequena ideia musical
- Tocando de ouvido uma melodia familiar

**Exercício Estrela: Treino de Transição Progressiva**
1. Escolha dois acordes difíceis de transicionar
2. Inicie com metrônomo a 40 BPM
3. Toque 4 tempos de cada acorde
4. Nos próximos 4 tempos, mude lentamente os dedos para a posição do segundo acorde
5. Continue alternando, sempre mantendo movimentos suaves e precisos
6. Faça 5 vezes sem erro antes de aumentar o tempo em 5 BPM

**Dica para Resultado Rápido:** Concentre-se em pequenos trechos e repita-os muitas vezes corretamente. É melhor aprender 4 compassos perfeitamente do que uma música inteira com falhas!`;
                }
                else { // 30 minutos (padrão) ou 20 minutos
                    aiResponse = `**Rotina de Treino para ${tempo}:**\n\n**Fase 1: Preparação e Técnica (${tempo === "20 minutos" ? "6" : "10"} min)**
- **Aquecimento (2 min):** Alongamentos de mão e dedos + tocar 1 escala simples.
- **Acordes (6 min):** Trabalhe em 3 acordes por dia. Para cada acorde:
  * Monte, verifique o som de cada corda (1 min)
  * Pratique 10 trocas com outro acorde (1 min)
- **Ritmo (5 min):** Pratique uma única batida com esses acordes.
- **Revisão (2 min):** Toque algo que você já sabe, mesmo que seja simples.

**Fase 2: Aplicação e Repertório (${tempo === "20 minutos" ? "10" : "15"} min)**
- **Trocas de Acordes (${tempo === "20 minutos" ? "4" : "6"} min):**
  * Escolha 3 acordes relacionados (ex: C, G, Am)
  * Pratique trocas limpas, um acorde a cada 4 tempos
  * Reduza para 2 tempos quando conseguir 5 trocas perfeitas consecutivas

- **Trabalho em Música (${tempo === "20 minutos" ? "6" : "9"} min):**
  * Foque em apenas um trecho pequeno de uma música
  * Pratique o trecho lentamente, aumentando a velocidade aos poucos
  * Ligue o trecho com o restante da música que você já conhece

**Fase 3: Integração e Criatividade (${tempo === "20 minutos" ? "4" : "5"} min)**
- **Sessão Livre:**
  * Toque algo que goste apenas por diversão
  * Tente improvisar sobre uma sequência simples de acordes
  * Revise algo que aprendeu anteriormente

**Exercício Especial do Dia: Técnica do Metrônomo Decrescente**
1. Escolha um exercício ou trecho musical que você está trabalhando
2. Configure o metrônomo em uma velocidade onde você consegue tocar perfeitamente
3. Toque por 1 minuto nesta velocidade
4. Aumente 5 BPM e toque por 30 segundos
5. Aumente mais 5 BPM e toque por 20 segundos
6. Volte à velocidade inicial e note como parece mais fácil agora

**Dica para Resultado Rápido:** Concentre-se em pequenos trechos e repita-os muitas vezes corretamente. É melhor aprender 4 compassos perfeitamente do que uma música inteira com falhas!`;
                }
            }
            
            // Campo harmônico
            else if (messageText.includes("campo harmônico") || (messageText.includes("progressão") && messageText.includes("acorde"))) {
                let tom = "Dó maior (C)";
                
                if (messageText.includes("sol") || messageText.includes(" g ") || messageText.includes(" g,") || messageText.includes(" g.") || messageText.includes(" g:"))
                    tom = "Sol maior (G)";
                else if (messageText.includes("ré") || messageText.includes(" d ") || messageText.includes(" d,") || messageText.includes(" d.") || messageText.includes(" d:"))
                    tom = "Ré maior (D)";
                else if (messageText.includes("lá") || messageText.includes(" a ") || messageText.includes(" a,") || messageText.includes(" a.") || messageText.includes(" a:"))
                    tom = "Lá maior (A)";
                else if (messageText.includes("mi") || messageText.includes(" e ") || messageText.includes(" e,") || messageText.includes(" e.") || messageText.includes(" e:"))
                    tom = "Mi maior (E)";
                else if (messageText.includes("fá") || messageText.includes(" f ") || messageText.includes(" f,") || messageText.includes(" f.") || messageText.includes(" f:"))
                    tom = "Fá maior (F)";
                else if (messageText.includes("si") || messageText.includes(" b ") || messageText.includes(" b,") || messageText.includes(" b.") || messageText.includes(" b:"))
                    tom = "Si maior (B)";
                
                const camposHarmonicos = {
                    "Dó maior (C)": ["C", "Dm", "Em", "F", "G", "Am", "Bº"],
                    "Sol maior (G)": ["G", "Am", "Bm", "C", "D", "Em", "F#º"],
                    "Ré maior (D)": ["D", "Em", "F#m", "G", "A", "Bm", "C#º"],
                    "Lá maior (A)": ["A", "Bm", "C#m", "D", "E", "F#m", "G#º"],
                    "Mi maior (E)": ["E", "F#m", "G#m", "A", "B", "C#m", "D#º"],
                    "Fá maior (F)": ["F", "Gm", "Am", "Bb", "C", "Dm", "Eº"],
                    "Si maior (B)": ["B", "C#m", "D#m", "E", "F#", "G#m", "A#º"]
                };
                
                const acordes = camposHarmonicos[tom];
                
                aiResponse = `**Campo Harmônico de ${tom}** 🎼\n\n**O que é o Campo Harmônico?**\nO campo harmônico é o conjunto de acordes que pertencem a uma tonalidade. Construímos estes acordes usando as notas da escala diatônica correspondente.\n\n**Campo Harmônico Maior - Graus e Acordes:**\n\n**I** - ${acordes[0]} (Maior)\n**ii** - ${acordes[1]} (menor)\n**iii** - ${acordes[2]} (menor)\n**IV** - ${acordes[3]} (Maior)\n**V** - ${acordes[4]} (Maior)\n**vi** - ${acordes[5]} (menor)\n**viiº** - ${acordes[6]} (diminuto)\n\n**Como Funciona:**\nCada grau tem uma função harmônica e "personalidade" específica:\n- **I (Tônica)**: Estabilidade, repouso, conclusão\n- **ii e IV (Subdominantes)**: Movimento, afastamento, tensão moderada\n- **V (Dominante)**: Alta tensão, necessidade de resolução\n- **iii e vi (Relativos menores)**: Contrastes emocionais\n- **viiº (Sensível)**: Tensão extrema, conduz à tônica\n\n**Progressões Comuns em ${tom}:**\n\n1. **Progressão I-IV-V** (${acordes[0]}-${acordes[3]}-${acordes[4]})\n   Clássica do rock, pop, sertanejo.\n\n2. **Progressão I-V-vi-IV** (${acordes[0]}-${acordes[4]}-${acordes[5]}-${acordes[3]})\n   Extremamente popular em baladas e pop moderno.\n\n3. **Progressão ii-V-I** (${acordes[1]}-${acordes[4]}-${acordes[0]})\n   Fundamental no jazz e bossa nova.\n\n4. **Progressão I-vi-IV-V** (${acordes[0]}-${acordes[5]}-${acordes[3]}-${acordes[4]})\n   Clássica dos anos 50-60, muito usada em ballads.\n\n**Exercício Prático: Treino de Campo Harmônico**\n\n1. **Toque os acordes em sequência:** ${acordes[0]} → ${acordes[1]} → ${acordes[2]} → ${acordes[3]} → ${acordes[4]} → ${acordes[5]} → ${acordes[6]} → ${acordes[0]}\n\n2. **Pratique as tríades em sequência na região aguda:**\n   Use apenas as cordas 1, 2 e 3 para tocar formas compactas de cada acorde\n\n3. **Crie uma melodia simples usando apenas notas da escala de ${tom.split(' ')[0]}:**\n   Toque a melodia sobre diferentes acordes do campo harmônico e note como o mesmo grupo de notas pode soar diferente dependendo do acorde de apoio\n\n4. **Experimente substituições de acordes:**\n   Onde teria um ${acordes[4]}, tente o ${acordes[2]} ou o ${acordes[6]}\n   Onde teria um ${acordes[0]}, tente o ${acordes[5]}\n\n**Dica para Composição:** A sequência vi-IV-I-V (${acordes[5]}-${acordes[3]}-${acordes[0]}-${acordes[4]}) soa incrível e é base de inúmeras músicas populares!`;
            }
            
            // Escalas e improvisação
            else if ((messageText.includes("escala") || messageText.includes("improvisar")) && !messageText.includes("afinar")) {
                let tom = "G";
                
                // Detectar o tom
                if (messageText.includes("sol") || messageText.includes(" g ") || messageText.includes(" g,") || messageText.includes(" g.") || messageText.includes(" g:"))
                    tom = "G";
                else if (messageText.includes("dó") || messageText.includes("do ") || messageText.includes(" c ") || messageText.includes(" c,") || messageText.includes(" c.") || messageText.includes(" c:"))
                    tom = "C";
                else if (messageText.includes("ré") || messageText.includes(" d ") || messageText.includes(" d,") || messageText.includes(" d.") || messageText.includes(" d:"))
                    tom = "D";
                else if (messageText.includes("lá") || messageText.includes(" a ") || messageText.includes(" a,") || messageText.includes(" a.") || messageText.includes(" a:"))
                    tom = "A";
                else if (messageText.includes("mi") || messageText.includes(" e ") || messageText.includes(" e,") || messageText.includes(" e.") || messageText.includes(" e:"))
                    tom = "E";
                
                // Determinar tipo de escala
                let tipoEscala = "pentatônica menor";
                if (messageText.includes("maior") || messageText.includes("major") || messageText.includes("jônica") || messageText.includes("jonica"))
                    tipoEscala = "maior";
                else if (messageText.includes("menor") || messageText.includes("minor") || messageText.includes("eólia") || messageText.includes("eolia"))
                    tipoEscala = "menor";
                else if (messageText.includes("blues"))
                    tipoEscala = "blues";
                
                // Criar resposta adequada
                if (tipoEscala === "pentatônica menor") {
                    aiResponse = `**Escala Pentatônica Menor de ${tom} para Improvisação** 🎸\n\n**Por que a Pentatônica?**\nA escala pentatônica menor é perfeita para iniciantes na improvisação porque:\n1. Tem apenas 5 notas (penta = cinco)\n2. Soa bem sobre praticamente qualquer acorde do tom\n3. É a base do blues, rock, pop e muito mais\n\n**Posição 1 - Escala Pentatônica Menor de ${tom}:**\n\nAqui está a forma mais usada (desenho em tablatura):\n\n`;
                    
                    // Diferentes formatos de tablaturas dependendo do tom
                    if (tom === "G") {
                        aiResponse += ````
E |---3---6---|
B |---3---6---|
G |---3---5---|
D |---3---5---|
A |---3---5---|
E |---3---6---|
````;
                    } 
                    else if (tom === "A") {
                        aiResponse += ````
E |---5---8---|
B |---5---8---|
G |---5---7---|
D |---5---7---|
A |---5---7---|
E |---5---8---|
````;
                    }
                    else if (tom === "E") {
                        aiResponse += ````
E |---0---3---|
B |---0---3---|
G |---0---2---|
D |---0---2---|
A |---0---2---|
E |---0---3---|
````;
                    }
                    else if (tom === "D") {
                        aiResponse += ``````
E |---10---13---|   (para ${tom})
B |---10---13---|
G |---10---12---|
D |---10---12---|
A |---10---12---|
E |---10---13---|
````;
                    }
                    else { // C ou outros
                        aiResponse += ````
E |---8---11---|
B |---8---11---|
G |---8---10---|
D |---8---10---|
A |---8---10---|
E |---8---11---|
````;
                    }
                    
                    aiResponse += `\n\n**Como Praticar a Improvisação:**\n\n**1. Exercício de Familiarização (5 min)**\n- Toque a escala ascendente e descendente lentamente\n- Use metrônomo a 60 BPM\n- Foque em produzir notas limpas e claras\n- Experimente diferentes dedilhados para encontrar o mais confortável\n\n**2. Exercício de Fraseado (7 min)**\n- Toque grupos de 3-4 notas da escala\n- Adicione técnicas expressivas como:\n  * Slides entre notas (deslizar o dedo de uma casa a outra)\n  * Bends (dobrar a corda para elevar a nota)\n  * Vibratos (pequena oscilação da nota)\n- Use pausas entre as frases - o silêncio é tão importante quanto as notas!\n\n**3. Exercício de Pergunta e Resposta (8 min)**\n- Toque uma frase curta (pergunta)\n- Responda com outra frase que complementa a primeira\n- Mantenha a coerência rítmica e melódica\n\n**4. Aplicação com backing track**\n- Busque no YouTube: "backing track ${tom} pentatonica" ou "${tom} minor pentatonic jam track"\n- Improvise usando suas frases sobre a base\n- Comece com poucas notas e gradualmente adicione complexidade\n\n**Exercício Semanal: O "Lick do Dia"**\n- Crie ou aprenda uma pequena frase musical (lick) por dia\n- Pratique esse lick em diferentes regiões do braço\n- Ao final de uma semana, combine os licks em um solo contínuo\n\n**Dica de Ouro:** Na improvisação, é melhor tocar poucas notas com sentimento e expressividade do que muitas notas rapidamente sem direção. Foque na musicalidade!`;
                } 
                else if (tipoEscala === "blues") {
                    // Resposta para escala blues
                    aiResponse = `**Escala Blues em ${tom}** 🎸🎵\n\n**O que é a Escala Blues?**\nA escala blues é uma variação da pentatônica menor com uma nota adicional (a famosa "blue note"), que dá aquele som característico do blues, rock e jazz.\n\n**Formato da Escala Blues em ${tom}:**\n\n`;
                    
                    // Diferentes formatos dependendo do tom
                    if (tom === "G") {
                        aiResponse += ````
E |---3------6---|
B |---3------6---|
G |---3--4--5---|
D |---3--4--5---|
A |---3--4--5---|
E |---3------6---|
             ^
          Blue note
````;
                    } 
                    else if (tom === "A") {
                        aiResponse += ````
E |---5------8---|
B |---5------8---|
G |---5--6--7---|
D |---5--6--7---|
A |---5--6--7---|
E |---5------8---|
             ^
          Blue note
````;
                    }
                    else if (tom === "E") {
                        aiResponse += ````
E |---0------3---|
B |---0------3---|
G |---0--1--2---|
D |---0--1--2---|
A |---0--1--2---|
E |---0------3---|
             ^
          Blue note
````;
                    }
                    else { // D, C ou outros
                        aiResponse += ````
E |---10------13---|   (para ${tom})
B |---10------13---|
G |---10--11--12---|
D |---10--11--12---|
A |---10--11--12---|
E |---10------13---|
               ^
            Blue note
````;
                    }
                    
                    aiResponse += `\n\n**Características da Escala Blues:**\n- Adiciona tensão e expressividade à pentatônica menor\n- A "blue note" (marcada acima) cria o som característico e emocional\n- Funciona muito bem em progressões I-IV-V (ex: ${tom}-${tom === "A" ? "D-E" : tom === "E" ? "A-B" : tom === "G" ? "C-D" : "F-G"})\n\n**Exercícios para Dominar a Escala Blues:**\n\n**1. Exercício Blues Básico (5 min)**\n- Toque a escala lentamente, enfatizando a blue note\n- Repita dando um pequeno bend (dobra) na blue note\n- Tente fazer vibratos nas notas longas\n\n**2. Exercício de Licks Clássicos (7 min)**\n- Aprenda este lick básico (toque lentamente):\n  * Toque a blue note na 3ª corda\n  * Faça um pequeno bend (não chegue à nota completa acima)\n  * Volte e toque a nota natural abaixo\n  * Termine na tônica\n\n**3. Exercício de Frases Blues (8 min)**\n- Use estas 3 técnicas nas suas frases:\n  * Repetição: repita uma nota ou padrão com variações rítmicas\n  * Call & Response: toque uma frase e "responda" com outra similar\n  * Silêncio: deixe espaços entre as frases (crucial no blues!)\n\n**Aplicação Prática:**\n1. Busque no YouTube: "slow blues in ${tom} backing track"\n2. Comece improvisando apenas nas primeiras 3 notas da escala\n3. Gradualmente adicione a blue note para criar tensão\n4. Resolva suas frases voltando para notas da pentatônica\n\n**Dica Avançada:** No blues, a expressividade é mais importante que a velocidade. Trabalhe no seu "feel" - bends precisos, vibratos controlados e timing relaxado são a essência do bom blues!`;
                } 
                else if (tipoEscala === "maior") {
                    // Resposta para escala maior
                    aiResponse = `**Escala Maior de ${tom} para Improvisação** 🎸\n\n**A Escala Maior Completa:**\nA escala maior é a "mãe" de todas as outras escalas e modos. Dominar esta escala abre portas para vários estilos, do rock ao jazz, do pop ao clássico.\n\n**Padrão da Escala ${tom} Maior na Posição Aberta:**\n\n`;
                    
                    // Diferentes formatos dependendo do tom
                    if (tom === "C") {
                        aiResponse += ````
E |---0---1---3---|
B |---0---1---3---|
G |---0---2---|
D |---0---2---|
A |---0---2---3---|
E |---0---1---3---|
     Do  Re  Mi   Fa  Sol La  Si   Do
     1   2   3    4    5   6   7    1
````;
                    }
                    else if (tom === "G") {
                        aiResponse += ````
E |---3------|
B |---0---1---3---|
G |---0------|
D |---0---2---4---|
A |---2---3---5---|
E |---3------|
     Sol La  Si   Do  Re  Mi  Fa#  Sol
     1   2   3    4   5   6   7    1
````;
                    }
                    else {
                        aiResponse += ````
Para a escala de ${tom} Maior:
As notas são: ${
                        {
                            "D": "Ré, Mi, Fá#, Sol, Lá, Si, Dó#, Ré",
                            "A": "Lá, Si, Dó#, Ré, Mi, Fá#, Sol#, Lá",
                            "E": "Mi, Fá#, Sol#, Lá, Si, Dó#, Ré#, Mi"
                        }[tom] || `${tom}... (solicite um diagrama específico para este tom)`
                        }

Graus:  1   2   3    4   5   6    7    1
````;
                    }
                    
            
            // Tuning
            else if (messageText.includes("afinar") || messageText.includes("afinação")) {
                aiResponse = `Afinação padrão do violão (da mais grossa para a mais fina): **E - A - D - G - B - E** (Mi - Lá - Ré - Sol - Si - Mi).\n\n**Como Afinar:**\n1.  **Use um Afinador:** Pode ser um app no celular (como GuitarTuna, Cifra Club Afinador) ou um afinador físico.\n2.  **Comece pela 6ª Corda (E grave):** Toque a corda solta e ajuste a tarraxa até o afinador mostrar 'E' e ficar verde (ou indicar que está afinado).\n3.  **Repita para as Outras:** Faça o mesmo para A (5ª), D (4ª), G (3ª), B (2ª) e E (1ª aguda).\n4.  **Verificação:** Toque todas as cordas novamente para garantir que a tensão não desafinou as outras.\n\n**Dica:** Afine sempre 'subindo' para a nota. Se passar, volte um pouco e suba novamente até o ponto certo. Isso ajuda a manter a afinação mais estável.`;
            }
        }

        // Função para lidar com o envio de mensagem do usuário
        async function handleSendMessage() {
            const message = userInput.value.trim();
            if (!message) return; // Não envia mensagens vazias
            
            // Adiciona a mensagem do usuário ao chat
            addMessage(message, 'user');
            
            // Limpa o campo de entrada
            userInput.value = '';
            
            // Mostra indicador de carregamento
            showLoadingIndicator();
            
            setTimeout(() => {
                try {
                    // Usa apenas respostas locais (fallback) sem tentar acessar API externa
                    const response = getFallbackResponse(message);
                    
                    // Remove o indicador de carregamento
                    removeLoadingIndicator();
                    
                    // Adiciona a resposta ao chat
                    addMessage(response, 'ai');
                } catch (error) {
                    console.error('Erro ao processar resposta:', error);
                    removeLoadingIndicator();
                    addMessage('Desculpe, tive um problema ao processar sua pergunta. Pode tentar novamente?', 'ai');
                }
            }, 500); // Pequeno delay para simular processamento
        }

        // Adiciona eventos de clique e tecla Enter para enviar mensagem
        sendMessageBtn.addEventListener('click', handleSendMessage);
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleSendMessage();
            }
        });

        // Adicionar estilos para o indicador de carregamento
        const styleElement = document.createElement('style');
        styleElement.textContent = `
            .message.loading span {
                display: inline-flex;
                align-items: center;
                font-style: italic;
                color: var(--secondary-color);
            }
            .message.loading span::after {
                content: '';
                width: 12px;
                height: 12px;
                margin-left: 8px;
                border: 2px solid var(--border-color);
                border-radius: 50%;
                border-top-color: var(--primary-color);
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
            
            /* Adiciona informação sobre a IA no rodapé */
            .ai-info {
                margin-top: 20px;
                font-size: 0.8rem;
                color: #E0E0E0; /* Lighter color for footer */
                text-align: center;
            }
            
            .ai-info a {
                color: var(--light-accent);
                text-decoration: none;
            }
            
            .ai-info a:hover {
                text-decoration: underline;
            }
        `;
        document.head.appendChild(styleElement);
        
        // Adiciona informações sobre a IA usada no rodapé
        const aiInfoElement = document.createElement('p');
        aiInfoElement.className = 'ai-info';
        document.querySelector('footer .container').appendChild(aiInfoElement);

        // Populate suggested questions on load
        document.addEventListener('DOMContentLoaded', populateSuggestedQuestions);
    </script>
</body>
</html>
