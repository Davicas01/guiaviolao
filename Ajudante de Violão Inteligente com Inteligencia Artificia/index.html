<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajudante de Viol√£o Inteligente com IA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #8B4513; /* Marrom escuro */
            --secondary-color: #A0522D; /* Marrom m√©dio */
            --accent-color: #CD853F; /* Marrom claro */
            --light-accent: #DEB887; /* Bege */
            --dark-text: #442C1E; /* Marrom muito escuro para texto */
            --light-text: #FFF8E1; /* Texto claro */
            --bg-light: #FAF0E6; /* Fundo claro */
            --border-color: #D3C1AE;
            --shadow: 0 5px 15px rgba(139, 69, 19, 0.15);
            --radius: 8px;
            --transition: all 0.3s ease;
            --bg-gradient: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--dark-text);
            background-color: var(--bg-light);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px; /* Added padding for container */
        }
        
        header {
            background: var(--bg-gradient);
            color: var(--light-text);
            padding: 3rem 1rem; /* Adjusted padding */
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-bottom: 5px solid var(--accent-color);
        }
        
        /* Removed header::before for cleaner look */
        
        header h1 {
            font-family: 'Poppins', sans-serif; /* Changed font */
            font-weight: 700;
            font-size: 2.5rem; /* Adjusted size */
            margin-bottom: 1rem; /* Adjusted margin */
            position: relative;
            z-index: 1;
        }
        
        .hero-text {
            font-size: 1.1rem; /* Adjusted size */
            max-width: 700px;
            margin: 0 auto 2rem; /* Adjusted margin */
            position: relative;
            z-index: 1;
            opacity: 0.9;
        }
        
        .hero-cta {
            position: relative;
            z-index: 1;
        }
        
        main {
            padding: 40px 0; /* Adjusted padding */
        }
        
        section {
            margin-bottom: 40px; /* Adjusted margin */
            background-color: #fff;
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
        }
        
        h2 {
            font-family: 'Poppins', sans-serif; /* Changed font */
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.8rem; /* Adjusted size */
            margin-bottom: 1.5rem; /* Adjusted margin */
            text-align: left; /* Align left */
            position: relative;
            padding-bottom: 10px; /* Adjusted padding */
            border-bottom: 2px solid var(--border-color); /* Add border bottom */
        }
        
        h2 i {
            margin-right: 10px;
            color: var(--secondary-color);
        }

        /* Removed h2::after */

        .ai-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: flex-start;
        }

        .camera-area, .feedback-area {
            background: var(--bg-light);
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }
        
        .camera-area h3, .feedback-area h3, #exercise-section h3, #chat-section h3 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
        }
        
        .camera-area h3 i, .feedback-area h3 i, #exercise-section h3 i, #chat-section h3 i {
            margin-right: 8px;
        }

        #cameraFeed {
            width: 100%;
            height: auto;
            background-color: #333;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            aspect-ratio: 16 / 9; /* Maintain aspect ratio */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #777;
        }
        
        #feedbackArea {
            min-height: 200px; /* Ensure minimum height */
            background-color: #fff;
            padding: 1rem;
            border-radius: var(--radius);
            border: 1px dashed var(--border-color);
            font-size: 0.95rem;
            overflow-y: auto; /* Add scroll if content overflows */
        }
        
        .feedback-item {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .feedback-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .feedback-item.positive { color: #2E7D32; }
        .feedback-item.negative { color: #B22222; }
        .feedback-item strong { color: var(--dark-text); }

        #exercise-section ul {
            list-style: none;
            padding: 0;
        }
        
        #exercise-section li {
            background: var(--bg-light);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: var(--radius);
            border-left: 4px solid var(--accent-color);
            font-size: 0.95rem;
        }
        
        #chat-section {
            margin-top: 30px;
        }

        /* Styles for Suggested Questions */
        #suggestedQuestions {
            padding: 1rem 1rem 0.5rem 1rem; /* Add padding */
            background-color: #fff; /* Match input area background */
            border: 1px solid var(--border-color);
            border-bottom: none; /* Remove bottom border to merge with input area */
            border-top-left-radius: var(--radius);
            border-top-right-radius: var(--radius);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        #suggestedQuestions h4 {
            width: 100%;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--secondary-color);
            font-weight: 500;
        }

        .suggested-question-btn {
            background-color: var(--bg-light);
            border: 1px solid var(--border-color);
            color: var(--dark-text);
            padding: 6px 12px;
            border-radius: 20px; /* Pill shape */
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .suggested-question-btn:hover {
            background-color: var(--light-accent);
            border-color: var(--secondary-color);
            transform: translateY(-1px);
        }
        /* End Styles for Suggested Questions */

        #chatInterface {
            display: flex;
            flex-direction: column;
            height: 400px; /* Fixed height for chat */
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            overflow: hidden;
            background-color: #fff;
            /* Remove top border radius if suggested questions are added */
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }
        
        #chatMessages {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            background-color: var(--bg-light);
        }
        
        .message {
            margin-bottom: 1rem;
            padding: 0.8rem 1rem;
            border-radius: var(--radius);
            max-width: 80%;
        }
        
        .message.user {
            background-color: var(--accent-color);
            color: var(--dark-text);
            margin-left: auto;
            text-align: right;
        }
        
        .message.ai {
            background-color: #fff;
            border: 1px solid var(--border-color);
            color: var(--dark-text);
            margin-right: auto;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .message.ai i {
            color: var(--primary-color);
            margin-top: 3px;
        }
        
        #inputArea {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            background-color: #fff;
        }
        
        #userInput {
            flex-grow: 1;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-right: 10px;
            font-size: 1rem;
        }
        
        .btn {
            background: var(--primary-color);
            color: var(--light-text);
            padding: 0.8rem 1.5rem; /* Adjusted padding */
            border-radius: var(--radius); /* Adjusted radius */
            text-decoration: none;
            display: inline-flex; /* Use flex for icon alignment */
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 1rem; /* Adjusted size */
            transition: var(--transition);
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
            gap: 8px; /* Space between icon and text */
        }
        
        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-secondary {
            background-color: var(--accent-color);
            color: var(--dark-text);
        }
        .btn-secondary:hover {
            background-color: var(--light-accent);
        }
        
        footer {
            background-color: var(--primary-color);
            color: var(--light-text);
            text-align: center;
            padding: 1.5rem 1rem; /* Adjusted padding */
            margin-top: 40px; /* Adjusted margin */
            border-top: 5px solid var(--accent-color);
        }
        
        .home-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: var(--light-text);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: var(--transition);
            z-index: 100;
            border: none;
        }
        
        .home-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.35);
        }
        
        .home-btn i {
            font-size: 24px;
        }
        
        @media (max-width: 992px) {
            .ai-section {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            header {
                padding: 2rem 1rem;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .hero-text {
                font-size: 1rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            section {
                padding: 1.5rem;
            }

            #cameraFeed {
                min-height: 200px; /* Adjust height for smaller screens */
            }
            
            #chatInterface {
                height: 350px;
            }
        }
        
        @media (max-width: 576px) {
            .btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
            }
            #userInput {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-robot"></i> Ajudante de Viol√£o Inteligente</h1>
            <p class="hero-text">Receba feedback em tempo real e acelere seu aprendizado com IA</p>
            <!-- Removed CTA button from header -->
        </div>
    </header>

    <main class="container">


        <section id="exercise-section">
            <h2><i class="fas fa-dumbbell"></i> Exerc√≠cios Sugeridos</h2>
            <h3><i class="fas fa-tasks"></i> Com base na an√°lise</h3>
            <ul id="exerciseList">
                <li>Nenhum exerc√≠cio sugerido ainda. Inicie a an√°lise.</li>
                <!-- Exercise items will be inserted here by JS -->
                <!-- Example:
                <li><strong>Foco: Posi√ß√£o do Polegar Esquerdo.</strong> Pratique o exerc√≠cio 'Aranha' lentamente, focando em manter o polegar centrado atr√°s do bra√ßo.</li>
                -->
            </ul>
        </section>

        <section id="chat-section">
            <h2><i class="fas fa-comments"></i> Converse com a IA</h2>
            <h3><i class="fas fa-question-circle"></i> Tire suas d√∫vidas</h3>
            <div id="suggestedQuestions">
                <h4>Experimente perguntar:</h4>
                <!-- Suggested question buttons will be inserted here by JS -->
            </div>
            <div id="chatInterface">
                <div id="chatMessages">
                    <div class="message ai">
                        <i class="fas fa-robot"></i>
                        <span>Ol√°! Sou seu Ajudante de Viol√£o Inteligente. Como posso ajudar voc√™ com seus estudos hoje? Pergunte sobre acordes, ritmos, t√©cnicas, teoria ou pe√ßa dicas!</span>
                    </div>
                    <!-- Chat messages will be inserted here by JS -->
                </div>
                <div id="inputArea">
                    <input type="text" id="userInput" placeholder="Digite sua pergunta aqui...">
                    <button id="sendMessageBtn" class="btn"><i class="fas fa-paper-plane"></i> Enviar</button>
                </div>
            </div>
        </section>
    </main>
    
    <footer>
        <div class="container">
            &copy; 2025 Domine o Violao - Todos os direitos reservados
        </div>
    </footer>

    <button class="home-btn" onclick="window.location.href='../index.html'"> <!-- Link to main index.html -->
        <i class="fas fa-home"></i>
    </button>

    <script>
        // Configura√ß√£o da API Hugging Face (gratuita)
        const HF_API_TOKEN = "hf_seu_token_aqui"; // Substitua pelo seu token gratuito do Hugging Face
        const MODEL_ID = "google/flan-t5-large"; // Modelo gratuito dispon√≠vel no Hugging Face
        
        // Elementos do DOM
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const userInput = document.getElementById('userInput');
        const chatMessages = document.getElementById('chatMessages');
        const suggestedQuestionsContainer = document.getElementById('suggestedQuestions');

        // Carregar as perguntas sugeridas imediatamente (sem esperar pelo evento DOMContentLoaded)
        populateSuggestedQuestions();

        // Adiciona eventos ao bot√£o de enviar e √† entrada de texto
        if (sendMessageBtn) {
            sendMessageBtn.addEventListener('click', handleSendMessage);
        }
        
        if (userInput) {
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleSendMessage();
                }
            });
        }

        // Inicializa√ß√£o - Garantir que tudo √© carregado corretamente
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM totalmente carregado");
            
            // Inicializar a interface do chat
            initChatInterface();
        });

        // Inicializa a interface do chat
        function initChatInterface() {
            // Adiciona eventos de clique e tecla Enter para enviar mensagem
            if (sendMessageBtn) {
                sendMessageBtn.addEventListener('click', handleSendMessage);
                console.log("Bot√£o de enviar configurado");
            } else {
                console.error("Bot√£o de enviar n√£o encontrado!");
            }

            if (userInput) {
                userInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleSendMessage();
                    }
                });
                console.log("Campo de entrada configurado");
            } else {
                console.error("Campo de entrada n√£o encontrado!");
            }
        }

        // --- Suggested Questions --- 
        const suggestedQuestionsList = [
            // Acordes b√°sicos
            "Como fazer o acorde de F√° Maior (F)?",
            "Como fazer o acorde B7?",
            "Como tocar o acorde de Sol menor (Gm)?",
            "Quais s√£o os acordes essenciais para iniciantes?",
            "O que significa C7?",
            "Me ensine todos os acordes com s√©tima",
            "Como fazer acordes suspensos (sus2, sus4)?",
            "Qual a diferen√ßa entre acorde maior e menor?",
            "Como fazer o acorde F√° sustenido menor (F#m)?",
            
            // T√©cnicas de m√£o esquerda
            "Me d√™ uma dica para a pestana n√£o falhar.",
            "Como melhorar a velocidade dos dedos?",
            "Como fazer vibrato no viol√£o?",
            "Como fazer um hammer-on?",
            "Como fazer pull-off corretamente?",
            "Truques para trocar acordes mais r√°pido",
            "Exerc√≠cios para fortalecer os dedos da m√£o esquerda",
            "Como fazer o slide no viol√£o?",
            "Como fazer bend no viol√£o?",
            
            // T√©cnicas de m√£o direita
            "Me ensine um dedilhado simples.",
            "Como tocar usando palheta corretamente?",
            "T√©cnicas de palm muting para iniciantes",
            "Exerc√≠cio para independ√™ncia dos dedos",
            "Como fazer rasqueado no viol√£o?",
            "Como fazer o tapping no viol√£o?",
            "T√©cnica de slap no viol√£o ac√∫stico",
            "Como alternar entre batida e dedilhado na mesma m√∫sica",
            
            // Ritmos
            "Qual o ritmo mais f√°cil para iniciantes?",
            "Me ensine o ritmo de reggae",
            "Como tocar batida de samba no viol√£o?",
            "Ritmo b√°sico de bossa nova",
            "Como tocar country no viol√£o?",
            "Ritmo de pop rock para viol√£o",
            "Como fazer levadas de funk no viol√£o?",
            "Ritmo de balada rom√¢ntica",
            
            // Fundamentos e afina√ß√£o
            "Como afinar o viol√£o?",
            "Quais os nomes das cordas soltas?",
            "Como trocar as cordas do viol√£o?",
            "Como praticar com metr√¥nomo?",
            "Como posicionar corretamente a m√£o esquerda?",
            "Meus dedos doem muito, o que fazer?",
            "Qual a diferen√ßa entre viol√£o de nylon e a√ßo?",
            "Como saber se meu viol√£o precisa de regulagem?",
            
            // Exerc√≠cios espec√≠ficos
            "Me passe um exerc√≠cio para trocar de C para G.",
            "Como melhorar minhas trocas de acordes?",
            "Exerc√≠cios para iniciantes praticarem todos os dias",
            "Como praticar escalas no viol√£o?",
            "Exerc√≠cios para agilidade de dedos",
            "Rotina de treino para 30 minutos por dia",
            "Como praticar de forma eficiente?",
            
            // Repert√≥rio e performance
            "M√∫sicas f√°ceis para iniciantes no viol√£o",
            "Como tocar e cantar ao mesmo tempo?",
            "Dicas para tocar bossa nova",
            "Como superar o medo de tocar para outras pessoas?",
            "Como memorizar m√∫sicas mais facilmente?",
            
            // Leitura e teoria
            "Como ler uma tablatura?",
            "Explique o campo harm√¥nico de D√≥ maior",
            "Como entender cifras com n√∫meros (C9, G13)?",
            "O que s√£o invers√µes de acordes?",
            "Qual escala usar para improvisar em G?",
            "Como funciona o Ciclo das Quintas?",
            "O que s√£o modos musicais?",
            "Como entender tonalidades no viol√£o?"
        ];

        function populateSuggestedQuestions() {
            // Certifique-se de que o container existe antes de tentar preench√™-lo
            if (!suggestedQuestionsContainer) {
                console.error("Container de perguntas sugeridas n√£o encontrado");
                return;
            }
            
            suggestedQuestionsContainer.innerHTML = '<h4>Experimente perguntar:</h4>';
            
            // Selecione 8 perguntas aleat√≥rias para n√£o sobrecarregar a interface
            const randomQuestions = [];
            const totalQuestions = suggestedQuestionsList.length;
            const numberOfQuestionsToShow = Math.min(8, totalQuestions);
            
            // Seleciona perguntas aleat√≥rias sem repetir
            while (randomQuestions.length < numberOfQuestionsToShow) {
                const randomIndex = Math.floor(Math.random() * totalQuestions);
                const question = suggestedQuestionsList[randomIndex];
                if (!randomQuestions.includes(question)) {
                    randomQuestions.push(question);
                }
            }
            
            // Adiciona as perguntas selecionadas ao container
            randomQuestions.forEach(question => {
                const button = document.createElement('button');
                button.classList.add('suggested-question-btn');
                button.textContent = question;
                button.addEventListener('click', () => {
                    userInput.value = question;
                    handleSendMessage(); // Envia a mensagem imediatamente ap√≥s clicar na sugest√£o
                });
                suggestedQuestionsContainer.appendChild(button);
            });
        }

        // --- Chat Logic ---
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender); // sender is 'user' or 'ai'
            
            if (sender === 'ai') {
                const icon = document.createElement('i');
                icon.className = 'fas fa-robot';
                messageDiv.appendChild(icon);
                const span = document.createElement('span');
                // Substituindo \n por <br> para preservar quebras de linha
                span.innerHTML = text.replace(/\n/g, '<br>');
                messageDiv.appendChild(span);
            } else {
                messageDiv.textContent = text;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom
        }

        // Adiciona um indicador de carregamento enquanto espera resposta da IA
        function showLoadingIndicator() {
            const loadingDiv = document.createElement('div');
            loadingDiv.classList.add('message', 'ai', 'loading');
            loadingDiv.id = 'loading-message';
            
            const icon = document.createElement('i');
            icon.className = 'fas fa-robot';
            loadingDiv.appendChild(icon);
            
            const span = document.createElement('span');
            span.textContent = "Pensando...";
            loadingDiv.appendChild(span);
            
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeLoadingIndicator() {
            const loadingElement = document.getElementById('loading-message');
            if (loadingElement) {
                loadingElement.remove();
            }
        }
        
        // Fun√ß√£o para obter resposta da Hugging Face API (gratuita)
        async function getAIResponse(prompt) {
            try {
                // Verifica se estamos em modo de demonstra√ß√£o ou se o token n√£o foi configurado
                if (!HF_API_TOKEN || HF_API_TOKEN === "hf_seu_token_aqui") {
                    console.warn("Token da API Hugging Face n√£o configurado. Usando respostas pr√©-definidas.");
                    // Adiciona um pequeno delay para simular o pensamento da IA
                    await new Promise(resolve => setTimeout(resolve, 500));
                    return getFallbackResponse(prompt);
                }

                // Cria um contexto espec√≠fico para viol√£o - Refinado
                const fullPrompt = `Voc√™ √© o 'Mestre das Cordas', um professor de viol√£o experiente, amig√°vel e muito paciente. Responda √† seguinte pergunta de um aluno de forma clara, did√°tica, passo a passo e encorajadora. Sempre que poss√≠vel, inclua:
1.  Uma explica√ß√£o conceitual simples.
2.  Instru√ß√µes pr√°ticas e detalhadas (posicionamento dos dedos, movimentos).
3.  Um pequeno exerc√≠cio pr√°tico relacionado √† pergunta, com instru√ß√µes claras.
4.  Uma dica extra ou um conselho motivacional.

Pergunta do aluno: "${prompt}"

Resposta do Mestre das Cordas:`;

                const response = await fetch(`https://api-inference.huggingface.co/models/${MODEL_ID}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${HF_API_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: fullPrompt,
                        parameters: {
                            max_new_tokens: 300, // Aumentado para respostas mais completas
                            temperature: 0.75, // Um pouco mais criativo
                            top_p: 0.9,
                            repetition_penalty: 1.1 // Evitar repeti√ß√µes
                        }
                    })
                });
                
                const result = await response.json();
                
                if (result && result[0] && result[0].generated_text) {
                    // Limpeza da resposta - remove o prompt da resposta e outros ru√≠dos
                    let cleanResponse = result[0].generated_text.replace(fullPrompt, '').trim();
                    // Remove poss√≠veis repeti√ß√µes do in√≠cio da resposta
                    if (cleanResponse.toLowerCase().startsWith(prompt.toLowerCase().substring(0, 10))) {
                         cleanResponse = cleanResponse.substring(prompt.length).trim();
                    }
                    return cleanResponse || getFallbackResponse(prompt); // Usa fallback se a resposta limpa for vazia
                } else if (result.error) {
                    console.error("Erro na API Hugging Face:", result.error);
                    return `Desculpe, tive um problema (${result.error}). Vamos tentar uma resposta local: ${getFallbackResponse(prompt)}`;
                } else {
                    console.error("Formato de resposta inesperado da Hugging Face:", result);
                    return getFallbackResponse(prompt);
                }
            } catch (error) {
                console.error("Erro ao conectar com a API Hugging Face:", error);
                return `N√£o consegui conectar ao meu c√©rebro principal! üß† Mas posso tentar ajudar com informa√ß√µes locais: ${getFallbackResponse(prompt)}`;
            }
        }
        
        // Respostas pr√©-definidas (Fallback) - Melhoradas e mais detalhadas
        function getFallbackResponse(messageText) {
            let aiResponse = "Desculpe, n√£o entendi bem. Pode reformular sua pergunta sobre viol√£o? Estou aqui para ajudar com afina√ß√£o, acordes, ritmos, t√©cnicas, teoria musical, leitura de cifras/tablaturas ou dicas gerais!";

            messageText = messageText.toLowerCase();

            // Pestana / F Chord
            if (messageText.includes("pestana") || messageText.includes("f√° maior") || messageText.includes("acorde f")) {
                aiResponse = `Ah, a famosa pestana! √â um desafio, mas voc√™ consegue! üí™\n\n**Para o F√° Maior (F):**\n1.  **Dedo 1 (Indicador):** Pressione TODAS as 6 cordas na 1¬™ casa (essa √© a pestana).\n2.  **Dedo 2 (M√©dio):** Na 2¬™ casa da corda G (3¬™ corda).\n3.  **Dedo 3 (Anelar):** Na 3¬™ casa da corda A (5¬™ corda).\n4.  **Dedo 4 (M√≠nimo):** Na 3¬™ casa da corda D (4¬™ corda).\n\n**Dicas Cruciais:**\n*   **Posi√ß√£o do Indicador:** Coloque o dedo indicador um pouco de lado, usando a parte mais '√≥ssea' para pressionar, n√£o a parte 'mole' da digital.\n*   **Polegar Oposto:** O polegar da m√£o esquerda deve estar posicionado atr√°s do bra√ßo, quase no meio, aplicando contra-press√£o.\n*   **Altura do Pulso:** Mantenha o pulso elevado e o antebra√ßo mais alinhado com o bra√ßo do viol√£o.\n*   **Dist√¢ncia do Traste:** A pestana deve estar bem pr√≥xima ao traste de metal (sem estar em cima dele).\n\n**Exerc√≠cios Progressivos para Dominar a Pestana:**\n\n**Exerc√≠cio 1: Pestana Parcial**\n- Fa√ßa pestana apenas nas primeiras 3 cordas (mais finas) na 1¬™ casa\n- Toque uma corda de cada vez, garantindo som limpo\n- Fa√ßa 5 s√©ries de 10 segundos seguradas, com 5 segundos de descanso\n\n**Exerc√≠cio 2: Pestana Vazia**\n- Fa√ßa pestana completa na 1¬™ casa (todas as 6 cordas) sem outros dedos\n- Toque cada corda separadamente - identifique onde o som n√£o sai limpo\n- Ajuste a press√£o e o √¢ngulo do dedo at√© melhorar\n\n**Exerc√≠cio 3: F Simplificado**\n- Tente o acorde F 'curto', apenas nas 4 primeiras cordas\n- Depois que dominar, adicione as outras cordas\n\n**Exerc√≠cio 4: Progress√£o de For√ßa**\n- Pratique pestanas em diferentes casas: 1¬™, 3¬™ e 5¬™ casa\n- A pestana na 1¬™ casa √© mais dif√≠cil! Se conseguir nas casas mais altas, volte para a 1¬™\n\nLembra que todo mundo passa por isso! Pratique 5-10 minutos por dia e em algumas semanas voc√™ ver√° grande diferen√ßa. N√£o desista!`;
            }
            // Leitura de cifras
            else if (messageText.includes("cifra") || (messageText.includes("ler") && messageText.includes("cifras"))) {
                aiResponse = `**Guia para Leitura de Cifras** üìù\n\n**O Que S√£o Cifras?**\nCifras s√£o uma nota√ß√£o simplificada que indica quais acordes tocar em uma m√∫sica, normalmente escritas acima da letra.\n\n**Elementos B√°sicos:**\n\n**1. Letra do Acorde Principal:**\nRepresenta a nota fundamental (C = D√≥, D = R√©, E = Mi, F = F√°, G = Sol, A = L√°, B = Si)\n\n**2. Qualidade do Acorde:**\n- **Sem indica√ß√£o:** Acorde maior (ex: C = D√≥ maior)\n- **m:** Acorde menor (ex: Am = L√° menor)\n- **7:** Acorde com s√©tima (ex: G7 = Sol com s√©tima)\n- **m7:** Acorde menor com s√©tima (ex: Dm7 = R√© menor com s√©tima)\n- **maj7:** Acorde maior com s√©tima maior (ex: Cmaj7 = D√≥ maior com s√©tima maior)\n- **dim ou ¬∫:** Acorde diminuto (ex: B¬∫ = Si diminuto)\n\n**3. Altera√ß√µes e Extens√µes:**\n- **sus4:** Suspensa 4 (ex: Dsus4)\n- **sus2:** Suspensa 2 (ex: Asus2)\n- **add9:** Acorde com nona adicionada (ex: Cadd9)\n- **6:** Acorde com sexta (ex: F6)\n- **9, 11, 13:** Extens√µes (ex: G9, D11, A13)\n\n**4. Altera√ß√µes na Fundamental:**\n- **#:** Sustenido (meio tom acima) - ex: F# = F√° sustenido\n- **b:** Bemol (meio tom abaixo) - ex: Bb = Si bemol\n\n**5. Invers√µes (baixo alternativo):**\n- **C/E:** Acorde de D√≥ maior com Mi no baixo\n- **Am/G:** Acorde de L√° menor com Sol no baixo\n\n**Como Ler uma Cifra Completa:**\n\n```\nC     Am    F       G7    Dm7b5   Cmaj7/E
‚Üì     ‚Üì      ‚Üì       ‚Üì      ‚Üì         ‚Üì
D√≥   L√°     F√°      Sol    R√©        D√≥ maior com
Maior Menor  Maior   dom.   menor     7¬™ maior e Mi
               com    7¬™    com 7¬™    no baixo
               7¬™     dim.
                    aiResponse = `**Melhorando as Trocas de Acordes:**\n\nTrocar acordes com fluidez √© um dos maiores desafios para violonistas iniciantes. Aqui est√£o exerc√≠cios que realmente funcionam:

**Exerc√≠cio 1: T√©cnica da Prepara√ß√£o Antecipada**
1. Escolha dois acordes para praticar (ex: G e C)
2. Monte o primeiro acorde (G) e toque-o quatro vezes
3. Sem tocar as cordas, mova apenas os dedos para a posi√ß√£o do segundo acorde (C)
4. Segure essa posi√ß√£o por 5 segundos, visualizando mentalmente
5. Toque o segundo acorde quatro vezes
6. Repita o processo voltando ao primeiro acorde
7. Execute este exerc√≠cio lentamente (60 BPM) por 5 minutos

**Exerc√≠cio 2: Treinamento Intervalado com Metr√¥nomo**
1. Ajuste o metr√¥nomo para 40 BPM
2. Toque o primeiro acorde em um beat
3. Voc√™ tem apenas um beat para mudar para o pr√≥ximo acorde
4. Toque o segundo acorde no beat seguinte
5. Continue alternando: acorde ‚Üí mudan√ßa ‚Üí acorde ‚Üí mudan√ßa...
6. A chave √© manter o tempo constante mesmo que precise fazer pausas
7. Gradualmente aumente a velocidade quando conseguir fazer 10 trocas perfeitas

**Exerc√≠cio 3: T√©cnica do Fotograma**
1. Monte o primeiro acorde
2. Remova TODOS os dedos do bra√ßo do viol√£o
3. Reposicione TODOS os dedos de volta no primeiro acorde de uma s√≥ vez
4. Repita 10 vezes, tentando colocar cada dedo exatamente no lugar certo
5. Fa√ßa o mesmo com o segundo acorde
6. Agora alterne: primeiro acorde ‚Üí remover dedos ‚Üí segundo acorde ‚Üí remover dedos...

**Exerc√≠cio 4: Identifica√ß√£o de Dedos Piv√¥**
1. Identifique quais dedos permanecem no mesmo lugar (ou quase) na transi√ß√£o
2. Mantenha esses "dedos piv√¥" no lugar enquanto move apenas os outros
3. Pratique a transi√ß√£o mantendo contato visual com os dedos piv√¥
4. Isso cria "√¢ncoras" para facilitar a mudan√ßa

**Dica de Ouro:** Sempre pratique transi√ß√µes em contexto musical. Escolha uma progress√£o simples de uma m√∫sica real e aplique estes exerc√≠cios. Isso torna o treino mais motivador e diretamente aplic√°vel!`;
                }
                return aiResponse; // Return early as this is a specific request
            }
            // Como melhorar velocidade dos dedos
            else if (messageText.includes("velocidade") && (messageText.includes("dedos") || messageText.includes("m√£o"))) {
                aiResponse = `**Como Melhorar a Velocidade dos Dedos no Viol√£o:**\n\nA velocidade √© resultado de movimentos precisos e eficientes, n√£o de for√ßa bruta. Aqui est√° um plano progressivo para desenvolver agilidade nos dedos:

**Fundamentos Essenciais:**
1. **Postura Correta:**
   * Punho levemente curvado, n√£o dobrado
   * Dedos arqueados, como se segurasse uma bola pequena
   * Polegar posicionado no meio do bra√ßo do viol√£o (n√£o aparecendo acima do bra√ßo)

2. **Movimento Econ√¥mico:**
   * Use apenas a press√£o necess√°ria (excesso de for√ßa = tens√£o = lentid√£o)
   * Mantenha os dedos pr√≥ximos √†s cordas (1-2 cm no m√°ximo)
   * Levante os dedos apenas o suficiente para mudar de posi√ß√£o

**Programa de Exerc√≠cios Progressivos (10 min/dia):**

**N√≠vel 1: Crom√°tico Fundamental (3 min)**
- Em uma √∫nica corda, posicione os dedos 1-2-3-4 nas casas consecutivas (ex: casas 1-2-3-4)
- Toque cada nota claramente em sequ√™ncia, mantendo os outros dedos pr√≥ximos √† corda
- Use metr√¥nomo a 60 BPM, uma nota por batida
- Quando conseguir 5 sequ√™ncias perfeitas, aumente 5 BPM
- Fa√ßa na corda E (1¬™), depois B (2¬™), etc.

**N√≠vel 2: Aranha (3 min)**
- Dedo 1 na casa 1, corda E (6¬™)
- Dedo 2 na casa 2, corda A (5¬™)
- Dedo 3 na casa 3, corda D (4¬™)
- Dedo 4 na casa 4, corda G (3¬™)
- Toque todas as notas, uma por uma
- Depois, mova tudo uma corda acima (casa 1/corda A, casa 2/corda D, etc.)
- Continue subindo at√© chegar √† corda E (1¬™)
- Des√ßa de volta √† posi√ß√£o inicial

**N√≠vel 3: Saltos Controlados (2 min)**
- Pratique saltos espec√≠ficos entre cordas/casas
- Exemplo: Dedo 1 na casa 5/corda D, depois salte para casa 2/corda B
- Fa√ßa o salto lentamente no in√≠cio, focando na precis√£o
- Aumente gradualmente a velocidade
- Crie padr√µes de saltos que simulem situa√ß√µes reais de m√∫sica

**N√≠vel 4: Aplica√ß√£o em Escalas (2 min)**
- Aprenda a escala pentat√¥nica menor na posi√ß√£o 1 (a mais b√°sica)
- Pratique tocando do grave ao agudo e vice-versa
- Use metr√¥nomo e aumente a velocidade gradualmente
- Quando confort√°vel, adicione varia√ß√µes r√≠tmicas (tercinas, qui√°lteras)

**Dica Profissional:** O segredo para ganhar velocidade √© praticar LENTAMENTE com aten√ß√£o total √† economia de movimento. Paradoxal, mas verdadeiro! Pratique com precis√£o a 60 BPM e voc√™ tocar√° com facilidade a 120 BPM em algumas semanas.

**Exerc√≠cio Extra: Treinamento de Independ√™ncia**
- Mantenha o dedo 1 na casa 1/corda E (6¬™)
- Tente tocar com o dedo 3 na casa 3/corda E, sem mover o dedo 1
- Depois tente com o dedo 4 na casa 4/corda E, ainda mantendo o dedo 1
- Gradualmente trabalhe diferentes combina√ß√µes de dedos fixos/m√≥veis

Lembre-se: N√£o force! Se sentir tens√£o ou dor, fa√ßa pausas frequentes e verifique sua t√©cnica. A fluidez vem antes da velocidade!`;
            }
            // Metr√¥nomo
            else if (messageText.includes("metr√¥nomo") || (messageText.includes("praticar") && messageText.includes("tempo"))) {
                aiResponse = `**Como Praticar com Metr√¥nomo de Forma Eficaz:**\n\nO metr√¥nomo √© sua ferramenta mais poderosa para desenvolver precis√£o r√≠tmica e velocidade controlada. Vamos domin√°-lo:

**Por que usar o metr√¥nomo:**
- Desenvolve seu senso de tempo interno
- Exp√µe inconsist√™ncias r√≠tmicas que voc√™ n√£o percebe
- For√ßa disciplina t√©cnica e controle
- Oferece uma forma mensur√°vel de acompanhar seu progresso

**Exerc√≠cios Progressivos:**

**Fase 1: Estabelecendo Base R√≠tmica (para iniciantes)**
1. Configure o metr√¥nomo em 70-80 BPM (batidas por minuto)
2. Toque um acorde simples fazendo apenas movimentos para baixo (‚Üì) em cada batida
3. Quando estiver confort√°vel, alterne entre baixo (‚Üì) e cima (‚Üë): ‚Üì‚Üë‚Üì‚Üë
4. Adicione varia√ß√µes: ‚Üì‚Üë‚Üë‚Üì, ‚Üì‚Üì‚Üë‚Üë, etc.
5. Pratique por 5-10 minutos di√°rios

**Fase 2: Subdividindo o Tempo (intermedi√°rio)**
1. Configure para 60 BPM
2. Toque o primeiro acorde em um beat
3. Voc√™ tem apenas um beat para mudar para o pr√≥ximo acorde
4. Toque o segundo acorde no beat seguinte
5. Continue alternando: acorde ‚Üí mudan√ßa ‚Üí acorde ‚Üí mudan√ßa...
6. A chave √© manter o tempo constante mesmo que precise fazer pausas
7. Gradualmente aumente a velocidade quando conseguir fazer 10 trocas perfeitas

**Fase 3: Deslocamentos R√≠tmicos (avan√ßado)**
1. Configure para 50-60 BPM
2. Em vez de tocar NA batida, toque ENTRE as batidas (contra-tempos)
3. Conte "1-e-2-e-3-e-4-e", mas toque apenas nos "e"
4. Tente alternar entre tocar nas batidas e nos contra-tempos
5. Isso desenvolve independ√™ncia r√≠tmica

**T√©cnicas de Pr√°tica Eficaz:**

**T√©cnica do Metr√¥nomo Decrescente:**
1. Comece em um andamento onde voc√™ consegue tocar perfeitamente (ex: 80 BPM)
2. Toque por 1 minuto nesta velocidade
3. Aumente 5 BPM e toque por 30 segundos
4. Aumente mais 5 BPM e toque por 20 segundos
5. Volte ao andamento inicial - ele parecer√° surpreendentemente mais f√°cil!

**Metr√¥nomo Silencioso:**
1. Ligue o metr√¥nomo e toque junto por 30 segundos
2. Silencie o metr√¥nomo por 4 compassos enquanto continua tocando
3. Ligue novamente para verificar se manteve o tempo
4. Gradualmente aumente o tempo "silencioso"

**Aplica√ß√µes Pr√°ticas:**
- Pratique transi√ß√µes de acordes com o metr√¥nomo em andamento lento
- Use para dominar passagens t√©cnicas dif√≠ceis
- Treine leituras de cifra/partitura mantendo o tempo constante

**Dica de Ouro:** Resista √† tenta√ß√£o de aumentar o tempo antes de dominar completamente o andamento atual. Sua meta √© precis√£o consistente, n√£o velocidade for√ßada!

**Apps de Metr√¥nomo Recomendados:** Pro Metronome, Soundbrenner, The Metronome by Musicroom (todos t√™m vers√µes gratuitas).`;
            }
            
            // Rhythms
            else if (messageText.includes("ritmo") || messageText.includes("batida")) {
                let ritmo = "Pop/Rock b√°sico";
                let desc = "‚Üì ‚Üì‚Üë ‚Üì‚Üë (Baixo, Baixo-Cima, Baixo-Cima)";
                let example = "Comum em muitas m√∫sicas pop e rock.";
                
                if (messageText.includes("rock")) {
                    ritmo = "Rock Cl√°ssico";
                    desc = "‚Üì ‚Üì‚Üë ‚Üë‚Üì‚Üë (Baixo, Baixo-Cima, Cima-Baixo-Cima)";
                    example = "Ex: Knockin' on Heaven's Door (vers√£o G'n'R)";
                } else if (messageText.includes("reggae")) {
                    ritmo = "Reggae Skank";
                    desc = "(Mudo) ‚Üë (Mudo) ‚Üë (Sil√™ncio nos tempos fortes, toque para cima nos contratempos)";
                    example = "Ex: Three Little Birds - Bob Marley";
                } else if (messageText.includes("samba") || messageText.includes("pagode")) {
                    ritmo = "Samba/Pagode B√°sico";
                    desc = "‚Üì ‚Üë‚Üì‚Üë ‚Üì‚Üë (Baixo, Cima-Baixo-Cima, Baixo-Cima)"; // Simplificado
                    example = "Leva caracter√≠stica, mas simplificado para iniciar.";
                } else if (messageText.includes("balada") || messageText.includes("lenta")) {
                    ritmo = "Balada Simples";
                    desc = "‚Üì (pausa) ‚Üì‚Üë (pausa) ‚Üì‚Üë (Baixo, pausa, Baixo-Cima, pausa, Baixo-Cima)";
                    example = "Ex: Hallelujah - Leonard Cohen";
                } else if (messageText.includes("valsa")) {
                    ritmo = "Valsa (3/4)";
                    desc = "‚Üì ‚Üë ‚Üë (Baixo, Cima, Cima)";
                    example = "M√∫sicas em compasso tern√°rio.";
                } else if (messageText.includes("bossa nova")) {
                    ritmo = "Bossa Nova B√°sica";
                    desc = "‚Üì (1) ‚Üë‚Üì (e) ‚Üë (2) ‚Üì (e) ‚Üë‚Üì (3) ‚Üë (4)";
                    example = "Ex: Garota de Ipanema - Tom Jobim";
                } else if (messageText.includes("funk")) {
                    ritmo = "Funk Brasileiro Simplificado";
                    desc = "‚Üì‚Üì ‚Üë‚Üë ‚Üì‚Üë ‚Üì‚Üë (com √™nfase nas batidas para cima)";
                    example = "Adapte para m√∫sicas de funk mais populares";
                } else if (messageText.includes("country")) {
                    ritmo = "Country B√°sico";
                    desc = "‚Üì ‚Üì‚Üë ‚Üì ‚Üì‚Üë (acentuando o baixo nos tempos 1 e 3)";
                    example = "Ex: Take Me Home, Country Roads - John Denver";
                } else if (messageText.includes("f√°cil") || messageText.includes("iniciante")) {
                     ritmo = "Super F√°cil";
                     desc = "‚Üì ‚Üì ‚Üì ‚Üì (Quatro toques para baixo por acorde)";
                     example = "√ìtimo para focar na troca de acordes no in√≠cio.";
                }

                aiResponse = `**Ritmo: ${ritmo}** üéµ\n\n**Padr√£o:** ${desc}\n*Exemplo de uso:* ${example}\n\n**Como Praticar este Ritmo:**\n\n**Passo 1: Entenda o Movimento**\n- ‚Üì = Movimento para baixo (com dedos ou palheta)
- ‚Üë = Movimento para cima (com dedos ou palheta)
- Pratique os movimentos no ar primeiro, sem tocar as cordas
- Use seu pulso de forma relaxada, n√£o o bra√ßo inteiro

**Passo 2: Pratique Sem Acordes**\n- Abafe todas as cordas levemente com a m√£o esquerda
- Pratique o padr√£o r√≠tmico puro, sem se preocupar com acordes
- Use metr√¥nomo em 60-70 BPM
- Repita at√© o movimento ficar autom√°tico (5 minutos)

**Passo 3: Adicione Um Acorde Simples**\n- Escolha um acorde f√°cil (Em ou Am)
- Mantenha o acorde formado enquanto executa o ritmo
- Continue com o metr√¥nomo
- Foque em manter a const√¢ncia do tempo

**Passo 4: Progress√£o Simples**\n- Use dois acordes que voc√™ domina (ex: Em - Am)
- Toque 4 repeti√ß√µes do ritmo em cada acorde
- Quando estiver confort√°vel, reduza para 2 repeti√ß√µes por acorde
- Pratique a transi√ß√£o suave entre os acordes sem perder o ritmo

**Dica T√©cnica:** O segredo de um bom ritmo est√° no pulso relaxado e na precis√£o do tempo. A for√ßa vem do pulso, n√£o dos dedos ou do bra√ßo.

**Exerc√≠cio de Fixa√ß√£o: Isolamento R√≠tmico**\n1. Grave-se tocando apenas o ritmo por 1 minuto
2. Ou√ßa a grava√ß√£o e identifique inconsist√™ncias
3. Pratique especificamente as partes problem√°ticas
4. Repita o processo at√© soar consistente

**Pr√≥ximo N√≠vel:** Depois de dominar este ritmo b√°sico, experimente adicionar acentos em determinadas batidas ou incluir batidas nas cordas mudas (percussivas) para enriquecer o som.

Quer experimentar outro ritmo ou aprender varia√ß√µes deste?`;
            }
            // Fingerpicking / Dedilhado
            else if (messageText.includes("dedilhado") || messageText.includes("fingerstyle") || messageText.includes("dedos")) {
                aiResponse = `O dedilhado √© uma t√©cnica que transforma completamente seu viol√£o! Vamos dominar isso! üé∂\n\n**Nomenclatura dos Dedos da M√£o Direita:**\n*   **p** = Polegar (geralmente toca as cordas graves: E, A, D - os 'bord√µes')\n*   **i** = Indicador (geralmente toca a corda G/3¬™)\n*   **m** = M√©dio (geralmente toca a corda B/2¬™)\n*   **a** = Anelar (geralmente toca a corda E aguda/1¬™)\n\n**Programa de Exerc√≠cios Progressivos:**\n\n**N√≠vel 1 - Independ√™ncia dos Dedos (5 min por dia)**\n1. **Exerc√≠cio B√°sico PIMA:**\n   * Monte um acorde simples como Am ou Em.\n   * Toque a sequ√™ncia: **p - i - m - a** (uma nota por tempo, 60 BPM).\n   * O polegar (p) toca a 5¬™ corda (A), indicador (i) toca a 3¬™ corda (G), m√©dio (m) toca a 2¬™ corda (B), anelar (a) toca a 1¬™ corda (E).\n   * Repita 10 vezes mantendo um ritmo constante.\n\n2. **Exerc√≠cio de Altern√¢ncia:**\n   * Mesmo acorde, agora toque: **p - i - p - m - p - a** (60 BPM).\n   * O polegar alterna com os outros dedos, criando um padr√£o de baixo alternado.\n   * Repita 10 vezes sem parar.\n\n**N√≠vel 2 - Arpejos Simples (7 min por dia)**\n1. **Arpejo Simples em C:**\n   * Monte o acorde de D√≥ (C).\n   * Toque: p(5¬™ corda) - i(3¬™ corda) - m(2¬™ corda) - a(1¬™ corda) - m(2¬™ corda) - i(3¬™ corda)\n   * Repita o padr√£o fluido, como uma onda.\n\n2. **Arpejo em Am:**\n   * Mude para o acorde de Am sem interromper o ritmo.\n   * Continue o mesmo padr√£o de dedos.\n   * Alterne entre C e Am a cada 4 repeti√ß√µes do padr√£o.\n\n**N√≠vel 3 - Travis Picking (T√©cnica de Country/Folk)**\n1. **Padr√£o B√°sico de Travis Picking:**\n   * Com acorde de C: Toque p(5¬™) - i(3¬™) - p(4¬™) - m(2¬™)\n   * Mantenha o polegar alternando entre as cordas graves enquanto os outros dedos criam a melodia.\n\n**Dicas T√©cnicas Essenciais:**\n\n1. **Postura da M√£o:**\n   * Mantenha o pulso levemente arqueado, como se estivesse segurando uma laranja.\n   * Dedos curvados e relaxados, nunca r√≠gidos.\n   * Polegar aponta ligeiramente para cima, n√£o paralelo √†s outras cordas.\n\n2. **Toque com as Pontas:**\n   * Use as pontas dos dedos, n√£o a parte carnuda.\n   * Exce√ß√£o: o polegar pode usar uma superf√≠cie maior para um som mais encorpado.\n\n3. **Prepara√ß√£o dos Dedos:**\n   * Posicione todos os dedos levemente sobre as cordas que ir√£o tocar antes de iniciar.\n   * Isso evita movimentos precipitados e garante precis√£o.\n\n**Aplica√ß√£o Pr√°tica: "Romanza" (Melodia Simples)**\nExperimente este trecho da famosa m√∫sica cl√°ssica:\n\n* Dedos i-m alternados na 1¬™ corda: 7-5-3-2-3-5-7-8-7-5-3-2-0\n* Depois, use o polegar para tocar a 3¬™ corda solta enquanto continua a melodia com i-m.\n\nPratique lentamente, com metr√¥nomo, e aumente a velocidade gradualmente. O segredo do dedilhado √© a consist√™ncia di√°ria, mesmo que por apenas 5-10 minutos!`;
            }
            
            // Pr√°tica Eficiente e Rotinas de Estudo
            if (messageText.includes("praticar") && (messageText.includes("eficiente") || messageText.includes("melhor forma"))) {
                aiResponse = `**Como Praticar Viol√£o de Forma Eficiente:**\n\n**1. Princ√≠pio de Pr√°tica Deliberada:**\n- **Foco em Dificuldades:** Identifique pontos fracos espec√≠ficos (uma troca de acorde dif√≠cil, um trecho r√°pido, etc.).
- **Isole o Problema:** Trabalhe em trechos pequenos (3-4 compassos) que contenham a dificuldade.
- **Repeti√ß√£o Consciente:** Fa√ßa repeti√ß√µes com aten√ß√£o total ao movimento, n√£o no "piloto autom√°tico".

**2. Estrutura de Pr√°tica (Modelo para 30 minutos):**\n- **Aquecimento (5 min):** Exerc√≠cios simples de t√©cnica, alongamentos.
- **Revis√£o (5 min):** Toque algo que j√° domina bem (refor√ßo positivo).
- **Ponto de Foco Principal (15 min):** Trabalhe intensamente em uma √∫nica habilidade.
- **Aplica√ß√£o Musical (5 min):** Aplique a t√©cnica em uma m√∫sica ou trecho musical.

**3. Exerc√≠cios Pr√°ticos para Sess√µes Curtas:**

**Exerc√≠cio #1: Pr√°tica de Transi√ß√µes em C√¢mera Lenta**
- Escolha uma transi√ß√£o de acordes dif√≠cil (ex: F ‚Üí C).
- Configure o metr√¥nomo em 40 BPM.
- Toque o primeiro acorde por 4 tempos.
- Use os pr√≥ximos 4 tempos para mover lentamente os dedos para a posi√ß√£o do segundo acorde.
- Continue alternando, sempre mantendo movimentos suaves e precisos.
- Fa√ßa 5 vezes sem erro antes de aumentar o tempo em 5 BPM.

**Exerc√≠cio #2: T√©cnica do Microsc√≥pio**
1. Selecione um trecho de 2-4 compassos de uma m√∫sica.
2. Toque em velocidade muito reduzida (30% da velocidade final).
3. Observe conscientemente cada movimento de dedo.
4. A cada repeti√ß√£o bem-sucedida, aumente 10% a velocidade.
5. Ao atingir 70%, volte para 30% e recomece o processo.

**Exerc√≠cio #3: Treino em Intervalos**
- Pratique por 25 minutos.
- Fa√ßa pausa obrigat√≥ria de 5 minutos (levante-se, alongue).
- Volte por mais 25 minutos.
- Este m√©todo aproveita o "Efeito de Primazia e Rec√™ncia" - aprendemos mais no in√≠cio e no final das sess√µes.

**4. Ferramentas Obrigat√≥rias:**
- **Metr√¥nomo:** Comece lento! Gradualmente aumente a velocidade.
- **Grava√ß√£o:** Grave seu treino frequentemente e ou√ßa criticamente.
- **Di√°rio de Pr√°tica:** Anote o que praticou, velocidade do metr√¥nomo, e desafios.

**Dica Motivacional:** Lembre-se que at√© os grandes m√∫sicos come√ßaram com os mesmos desafios. O segredo n√£o est√° em sess√µes longas, mas sim na consist√™ncia di√°ria e na pr√°tica consciente!`;
            }
            
            // Rotina de treino para tempo espec√≠fico
            else if ((messageText.includes("rotina") || messageText.includes("treino")) && 
                    (messageText.includes("30 minutos") || messageText.includes("meia hora") || 
                     messageText.includes("15 minutos") || messageText.includes("20 minutos") || messageText.includes("uma hora"))) {
                
                let tempo = "30 minutos";
                if (messageText.includes("15 minutos")) tempo = "15 minutos";
                if (messageText.includes("20 minutos")) tempo = "20 minutos";
                if (messageText.includes("uma hora") || messageText.includes("60 minutos")) tempo = "60 minutos";
                
                if (tempo === "15 minutos") {
                    aiResponse = `**Rotina Eficiente de 15 Minutos Di√°rios:**\n\n**Dias 1, 3, 5 (Foco T√©cnico)**\n- **Aquecimento (2 min):** Alongamentos de m√£o e dedos + tocar 1 escala simples.
- **Acordes (6 min):** Trabalhe em 3 acordes por dia. Para cada acorde:
  * Monte, verifique o som de cada corda (1 min)
  * Pratique 10 trocas com outro acorde (1 min)
- **Ritmo (5 min):** Pratique uma √∫nica batida com esses acordes.
- **Revis√£o (2 min):** Toque algo que voc√™ j√° sabe, mesmo que seja simples.

**Dias 2, 4, 6 (Foco Musical)**\n- **Aquecimento (2 min):** Mesmo procedimento.
- **Progress√£o (5 min):** Pratique uma progress√£o de 2-3 acordes com ritmo.
- **Trecho de M√∫sica (7 min):** Trabalhe em um pequeno trecho de uma m√∫sica.
- **Divers√£o (1 min):** Termine improvisando algo livremente.

**Exerc√≠cio Espec√≠fico: A T√©cnica Sandu√≠che (para qualquer trecho dif√≠cil)**\n- Toque o compasso ANTES do trecho dif√≠cil
- Toque o trecho dif√≠cil LENTAMENTE
- Toque o compasso DEPOIS do trecho dif√≠cil
- Repita este "sandu√≠che" 5 vezes

**Dica Motivacional:** 15 minutos consistentes todos os dias produzem resultados muito melhores que sess√µes longas ocasionais. Celebre pequenas vit√≥rias di√°rias!`;
                }
                else if (tempo === "60 minutos") {
                    aiResponse = `**Rotina Completa de 1 Hora de Pr√°tica:**\n\n**Estrutura Recomendada:**

**1. Aquecimento (10 min)**
- Alongamentos para m√£os e punhos (2 min)
- Exerc√≠cio "Dedos de Aranha" em todas as cordas (3 min)
- Escalas crom√°ticas em uma corda (3 min)
- Exerc√≠cio de independ√™ncia dos dedos (2 min)

**2. T√©cnica Fundamental (15 min)**
- **Dias Pares:** Trabalho de M√£o Direita
  * Altern√¢ncia de dedos p-i-m-a em padr√µes (5 min)
  * Pr√°tica de batidas r√≠tmicas espec√≠ficas (5 min)
  * Exerc√≠cios de palhetada alternada (5 min)
- **Dias √çmpares:** Trabalho de M√£o Esquerda
  * Exerc√≠cios de pestana com metr√¥nomo (5 min)
  * Hammer-ons e pull-offs em sequ√™ncia (5 min)
  * Exerc√≠cio de alongamento para dedos 1-3-4 (5 min)

**3. Repert√≥rio (25 min)**
- Revis√£o de m√∫sica(s) j√° conhecida(s) (5 min)
- Trabalho em se√ß√£o nova/dif√≠cil (10 min)
- Pr√°tica de uma m√∫sica completa (10 min)

**4. Teoria Aplicada (5 min)**
- **Op√ß√µes rotativas:**
  * Identificar notas no bra√ßo do viol√£o
  * Construir acordes a partir de f√≥rmulas
  * Praticar uma escala em diferentes posi√ß√µes
  * Criar uma progress√£o de acordes simples

**5. Sess√£o Livre/Criativa (5 min)**
- Improviso sobre uma progress√£o simples
- Composi√ß√£o de uma pequena ideia musical
- Tocando de ouvido uma melodia familiar

**Exerc√≠cio Estrela: Treino de Transi√ß√£o Progressiva**
1. Escolha dois acordes dif√≠ceis de transicionar
2. Inicie com metr√¥nomo a 40 BPM
3. Toque 4 tempos de cada acorde
4. Nos pr√≥ximos 4 tempos, mude lentamente os dedos para a posi√ß√£o do segundo acorde
5. Continue alternando, sempre mantendo movimentos suaves e precisos
6. Fa√ßa 5 vezes sem erro antes de aumentar o tempo em 5 BPM

**Dica para Resultado R√°pido:** Concentre-se em pequenos trechos e repita-os muitas vezes corretamente. √â melhor aprender 4 compassos perfeitamente do que uma m√∫sica inteira com falhas!`;
                }
                else { // 30 minutos (padr√£o) ou 20 minutos
                    aiResponse = `**Rotina de Treino para ${tempo}:**\n\n**Fase 1: Prepara√ß√£o e T√©cnica (${tempo === "20 minutos" ? "6" : "10"} min)**
- **Aquecimento (2 min):** Alongamentos de m√£o e dedos + tocar 1 escala simples.
- **Acordes (6 min):** Trabalhe em 3 acordes por dia. Para cada acorde:
  * Monte, verifique o som de cada corda (1 min)
  * Pratique 10 trocas com outro acorde (1 min)
- **Ritmo (5 min):** Pratique uma √∫nica batida com esses acordes.
- **Revis√£o (2 min):** Toque algo que voc√™ j√° sabe, mesmo que seja simples.

**Fase 2: Aplica√ß√£o e Repert√≥rio (${tempo === "20 minutos" ? "10" : "15"} min)**
- **Trocas de Acordes (${tempo === "20 minutos" ? "4" : "6"} min):**
  * Escolha 3 acordes relacionados (ex: C, G, Am)
  * Pratique trocas limpas, um acorde a cada 4 tempos
  * Reduza para 2 tempos quando conseguir 5 trocas perfeitas consecutivas

- **Trabalho em M√∫sica (${tempo === "20 minutos" ? "6" : "9"} min):**
  * Foque em apenas um trecho pequeno de uma m√∫sica
  * Pratique o trecho lentamente, aumentando a velocidade aos poucos
  * Ligue o trecho com o restante da m√∫sica que voc√™ j√° conhece

**Fase 3: Integra√ß√£o e Criatividade (${tempo === "20 minutos" ? "4" : "5"} min)**
- **Sess√£o Livre:**
  * Toque algo que goste apenas por divers√£o
  * Tente improvisar sobre uma sequ√™ncia simples de acordes
  * Revise algo que aprendeu anteriormente

**Exerc√≠cio Especial do Dia: T√©cnica do Metr√¥nomo Decrescente**
1. Escolha um exerc√≠cio ou trecho musical que voc√™ est√° trabalhando
2. Configure o metr√¥nomo em uma velocidade onde voc√™ consegue tocar perfeitamente
3. Toque por 1 minuto nesta velocidade
4. Aumente 5 BPM e toque por 30 segundos
5. Aumente mais 5 BPM e toque por 20 segundos
6. Volte √† velocidade inicial e note como parece mais f√°cil agora

**Dica para Resultado R√°pido:** Concentre-se em pequenos trechos e repita-os muitas vezes corretamente. √â melhor aprender 4 compassos perfeitamente do que uma m√∫sica inteira com falhas!`;
                }
            }
            
            // Campo harm√¥nico
            else if (messageText.includes("campo harm√¥nico") || (messageText.includes("progress√£o") && messageText.includes("acorde"))) {
                let tom = "D√≥ maior (C)";
                
                if (messageText.includes("sol") || messageText.includes(" g ") || messageText.includes(" g,") || messageText.includes(" g.") || messageText.includes(" g:"))
                    tom = "Sol maior (G)";
                else if (messageText.includes("r√©") || messageText.includes(" d ") || messageText.includes(" d,") || messageText.includes(" d.") || messageText.includes(" d:"))
                    tom = "R√© maior (D)";
                else if (messageText.includes("l√°") || messageText.includes(" a ") || messageText.includes(" a,") || messageText.includes(" a.") || messageText.includes(" a:"))
                    tom = "L√° maior (A)";
                else if (messageText.includes("mi") || messageText.includes(" e ") || messageText.includes(" e,") || messageText.includes(" e.") || messageText.includes(" e:"))
                    tom = "Mi maior (E)";
                else if (messageText.includes("f√°") || messageText.includes(" f ") || messageText.includes(" f,") || messageText.includes(" f.") || messageText.includes(" f:"))
                    tom = "F√° maior (F)";
                else if (messageText.includes("si") || messageText.includes(" b ") || messageText.includes(" b,") || messageText.includes(" b.") || messageText.includes(" b:"))
                    tom = "Si maior (B)";
                
                const camposHarmonicos = {
                    "D√≥ maior (C)": ["C", "Dm", "Em", "F", "G", "Am", "B¬∫"],
                    "Sol maior (G)": ["G", "Am", "Bm", "C", "D", "Em", "F#¬∫"],
                    "R√© maior (D)": ["D", "Em", "F#m", "G", "A", "Bm", "C#¬∫"],
                    "L√° maior (A)": ["A", "Bm", "C#m", "D", "E", "F#m", "G#¬∫"],
                    "Mi maior (E)": ["E", "F#m", "G#m", "A", "B", "C#m", "D#¬∫"],
                    "F√° maior (F)": ["F", "Gm", "Am", "Bb", "C", "Dm", "E¬∫"],
                    "Si maior (B)": ["B", "C#m", "D#m", "E", "F#", "G#m", "A#¬∫"]
                };
                
                const acordes = camposHarmonicos[tom];
                
                aiResponse = `**Campo Harm√¥nico de ${tom}** üéº\n\n**O que √© o Campo Harm√¥nico?**\nO campo harm√¥nico √© o conjunto de acordes que pertencem a uma tonalidade. Constru√≠mos estes acordes usando as notas da escala diat√¥nica correspondente.\n\n**Campo Harm√¥nico Maior - Graus e Acordes:**\n\n**I** - ${acordes[0]} (Maior)\n**ii** - ${acordes[1]} (menor)\n**iii** - ${acordes[2]} (menor)\n**IV** - ${acordes[3]} (Maior)\n**V** - ${acordes[4]} (Maior)\n**vi** - ${acordes[5]} (menor)\n**vii¬∫** - ${acordes[6]} (diminuto)\n\n**Como Funciona:**\nCada grau tem uma fun√ß√£o harm√¥nica e "personalidade" espec√≠fica:\n- **I (T√¥nica)**: Estabilidade, repouso, conclus√£o\n- **ii e IV (Subdominantes)**: Movimento, afastamento, tens√£o moderada\n- **V (Dominante)**: Alta tens√£o, necessidade de resolu√ß√£o\n- **iii e vi (Relativos menores)**: Contrastes emocionais\n- **vii¬∫ (Sens√≠vel)**: Tens√£o extrema, conduz √† t√¥nica\n\n**Progress√µes Comuns em ${tom}:**\n\n1. **Progress√£o I-IV-V** (${acordes[0]}-${acordes[3]}-${acordes[4]})\n   Cl√°ssica do rock, pop, sertanejo.\n\n2. **Progress√£o I-V-vi-IV** (${acordes[0]}-${acordes[4]}-${acordes[5]}-${acordes[3]})\n   Extremamente popular em baladas e pop moderno.\n\n3. **Progress√£o ii-V-I** (${acordes[1]}-${acordes[4]}-${acordes[0]})\n   Fundamental no jazz e bossa nova.\n\n4. **Progress√£o I-vi-IV-V** (${acordes[0]}-${acordes[5]}-${acordes[3]}-${acordes[4]})\n   Cl√°ssica dos anos 50-60, muito usada em ballads.\n\n**Exerc√≠cio Pr√°tico: Treino de Campo Harm√¥nico**\n\n1. **Toque os acordes em sequ√™ncia:** ${acordes[0]} ‚Üí ${acordes[1]} ‚Üí ${acordes[2]} ‚Üí ${acordes[3]} ‚Üí ${acordes[4]} ‚Üí ${acordes[5]} ‚Üí ${acordes[6]} ‚Üí ${acordes[0]}\n\n2. **Pratique as tr√≠ades em sequ√™ncia na regi√£o aguda:**\n   Use apenas as cordas 1, 2 e 3 para tocar formas compactas de cada acorde\n\n3. **Crie uma melodia simples usando apenas notas da escala de ${tom.split(' ')[0]}:**\n   Toque a melodia sobre diferentes acordes do campo harm√¥nico e note como o mesmo grupo de notas pode soar diferente dependendo do acorde de apoio\n\n4. **Experimente substitui√ß√µes de acordes:**\n   Onde teria um ${acordes[4]}, tente o ${acordes[2]} ou o ${acordes[6]}\n   Onde teria um ${acordes[0]}, tente o ${acordes[5]}\n\n**Dica para Composi√ß√£o:** A sequ√™ncia vi-IV-I-V (${acordes[5]}-${acordes[3]}-${acordes[0]}-${acordes[4]}) soa incr√≠vel e √© base de in√∫meras m√∫sicas populares!`;
            }
            
            // Escalas e improvisa√ß√£o
            else if ((messageText.includes("escala") || messageText.includes("improvisar")) && !messageText.includes("afinar")) {
                let tom = "G";
                
                // Detectar o tom
                if (messageText.includes("sol") || messageText.includes(" g ") || messageText.includes(" g,") || messageText.includes(" g.") || messageText.includes(" g:"))
                    tom = "G";
                else if (messageText.includes("d√≥") || messageText.includes("do ") || messageText.includes(" c ") || messageText.includes(" c,") || messageText.includes(" c.") || messageText.includes(" c:"))
                    tom = "C";
                else if (messageText.includes("r√©") || messageText.includes(" d ") || messageText.includes(" d,") || messageText.includes(" d.") || messageText.includes(" d:"))
                    tom = "D";
                else if (messageText.includes("l√°") || messageText.includes(" a ") || messageText.includes(" a,") || messageText.includes(" a.") || messageText.includes(" a:"))
                    tom = "A";
                else if (messageText.includes("mi") || messageText.includes(" e ") || messageText.includes(" e,") || messageText.includes(" e.") || messageText.includes(" e:"))
                    tom = "E";
                
                // Determinar tipo de escala
                let tipoEscala = "pentat√¥nica menor";
                if (messageText.includes("maior") || messageText.includes("major") || messageText.includes("j√¥nica") || messageText.includes("jonica"))
                    tipoEscala = "maior";
                else if (messageText.includes("menor") || messageText.includes("minor") || messageText.includes("e√≥lia") || messageText.includes("eolia"))
                    tipoEscala = "menor";
                else if (messageText.includes("blues"))
                    tipoEscala = "blues";
                
                // Criar resposta adequada
                if (tipoEscala === "pentat√¥nica menor") {
                    aiResponse = `**Escala Pentat√¥nica Menor de ${tom} para Improvisa√ß√£o** üé∏\n\n**Por que a Pentat√¥nica?**\nA escala pentat√¥nica menor √© perfeita para iniciantes na improvisa√ß√£o porque:\n1. Tem apenas 5 notas (penta = cinco)\n2. Soa bem sobre praticamente qualquer acorde do tom\n3. √â a base do blues, rock, pop e muito mais\n\n**Posi√ß√£o 1 - Escala Pentat√¥nica Menor de ${tom}:**\n\nAqui est√° a forma mais usada (desenho em tablatura):\n\n`;
                    
                    // Diferentes formatos de tablaturas dependendo do tom
                    if (tom === "G") {
                        aiResponse += ````
E |---3---6---|
B |---3---6---|
G |---3---5---|
D |---3---5---|
A |---3---5---|
E |---3---6---|
````;
                    } 
                    else if (tom === "A") {
                        aiResponse += ````
E |---5---8---|
B |---5---8---|
G |---5---7---|
D |---5---7---|
A |---5---7---|
E |---5---8---|
````;
                    }
                    else if (tom === "E") {
                        aiResponse += ````
E |---0---3---|
B |---0---3---|
G |---0---2---|
D |---0---2---|
A |---0---2---|
E |---0---3---|
````;
                    }
                    else if (tom === "D") {
                        aiResponse += ``````
E |---10---13---|   (para ${tom})
B |---10---13---|
G |---10---12---|
D |---10---12---|
A |---10---12---|
E |---10---13---|
````;
                    }
                    else { // C ou outros
                        aiResponse += ````
E |---8---11---|
B |---8---11---|
G |---8---10---|
D |---8---10---|
A |---8---10---|
E |---8---11---|
````;
                    }
                    
                    aiResponse += `\n\n**Como Praticar a Improvisa√ß√£o:**\n\n**1. Exerc√≠cio de Familiariza√ß√£o (5 min)**\n- Toque a escala ascendente e descendente lentamente\n- Use metr√¥nomo a 60 BPM\n- Foque em produzir notas limpas e claras\n- Experimente diferentes dedilhados para encontrar o mais confort√°vel\n\n**2. Exerc√≠cio de Fraseado (7 min)**\n- Toque grupos de 3-4 notas da escala\n- Adicione t√©cnicas expressivas como:\n  * Slides entre notas (deslizar o dedo de uma casa a outra)\n  * Bends (dobrar a corda para elevar a nota)\n  * Vibratos (pequena oscila√ß√£o da nota)\n- Use pausas entre as frases - o sil√™ncio √© t√£o importante quanto as notas!\n\n**3. Exerc√≠cio de Pergunta e Resposta (8 min)**\n- Toque uma frase curta (pergunta)\n- Responda com outra frase que complementa a primeira\n- Mantenha a coer√™ncia r√≠tmica e mel√≥dica\n\n**4. Aplica√ß√£o com backing track**\n- Busque no YouTube: "backing track ${tom} pentatonica" ou "${tom} minor pentatonic jam track"\n- Improvise usando suas frases sobre a base\n- Comece com poucas notas e gradualmente adicione complexidade\n\n**Exerc√≠cio Semanal: O "Lick do Dia"**\n- Crie ou aprenda uma pequena frase musical (lick) por dia\n- Pratique esse lick em diferentes regi√µes do bra√ßo\n- Ao final de uma semana, combine os licks em um solo cont√≠nuo\n\n**Dica de Ouro:** Na improvisa√ß√£o, √© melhor tocar poucas notas com sentimento e expressividade do que muitas notas rapidamente sem dire√ß√£o. Foque na musicalidade!`;
                } 
                else if (tipoEscala === "blues") {
                    // Resposta para escala blues
                    aiResponse = `**Escala Blues em ${tom}** üé∏üéµ\n\n**O que √© a Escala Blues?**\nA escala blues √© uma varia√ß√£o da pentat√¥nica menor com uma nota adicional (a famosa "blue note"), que d√° aquele som caracter√≠stico do blues, rock e jazz.\n\n**Formato da Escala Blues em ${tom}:**\n\n`;
                    
                    // Diferentes formatos dependendo do tom
                    if (tom === "G") {
                        aiResponse += ````
E |---3------6---|
B |---3------6---|
G |---3--4--5---|
D |---3--4--5---|
A |---3--4--5---|
E |---3------6---|
             ^
          Blue note
````;
                    } 
                    else if (tom === "A") {
                        aiResponse += ````
E |---5------8---|
B |---5------8---|
G |---5--6--7---|
D |---5--6--7---|
A |---5--6--7---|
E |---5------8---|
             ^
          Blue note
````;
                    }
                    else if (tom === "E") {
                        aiResponse += ````
E |---0------3---|
B |---0------3---|
G |---0--1--2---|
D |---0--1--2---|
A |---0--1--2---|
E |---0------3---|
             ^
          Blue note
````;
                    }
                    else { // D, C ou outros
                        aiResponse += ````
E |---10------13---|   (para ${tom})
B |---10------13---|
G |---10--11--12---|
D |---10--11--12---|
A |---10--11--12---|
E |---10------13---|
               ^
            Blue note
````;
                    }
                    
                    aiResponse += `\n\n**Caracter√≠sticas da Escala Blues:**\n- Adiciona tens√£o e expressividade √† pentat√¥nica menor\n- A "blue note" (marcada acima) cria o som caracter√≠stico e emocional\n- Funciona muito bem em progress√µes I-IV-V (ex: ${tom}-${tom === "A" ? "D-E" : tom === "E" ? "A-B" : tom === "G" ? "C-D" : "F-G"})\n\n**Exerc√≠cios para Dominar a Escala Blues:**\n\n**1. Exerc√≠cio Blues B√°sico (5 min)**\n- Toque a escala lentamente, enfatizando a blue note\n- Repita dando um pequeno bend (dobra) na blue note\n- Tente fazer vibratos nas notas longas\n\n**2. Exerc√≠cio de Licks Cl√°ssicos (7 min)**\n- Aprenda este lick b√°sico (toque lentamente):\n  * Toque a blue note na 3¬™ corda\n  * Fa√ßa um pequeno bend (n√£o chegue √† nota completa acima)\n  * Volte e toque a nota natural abaixo\n  * Termine na t√¥nica\n\n**3. Exerc√≠cio de Frases Blues (8 min)**\n- Use estas 3 t√©cnicas nas suas frases:\n  * Repeti√ß√£o: repita uma nota ou padr√£o com varia√ß√µes r√≠tmicas\n  * Call & Response: toque uma frase e "responda" com outra similar\n  * Sil√™ncio: deixe espa√ßos entre as frases (crucial no blues!)\n\n**Aplica√ß√£o Pr√°tica:**\n1. Busque no YouTube: "slow blues in ${tom} backing track"\n2. Comece improvisando apenas nas primeiras 3 notas da escala\n3. Gradualmente adicione a blue note para criar tens√£o\n4. Resolva suas frases voltando para notas da pentat√¥nica\n\n**Dica Avan√ßada:** No blues, a expressividade √© mais importante que a velocidade. Trabalhe no seu "feel" - bends precisos, vibratos controlados e timing relaxado s√£o a ess√™ncia do bom blues!`;
                } 
                else if (tipoEscala === "maior") {
                    // Resposta para escala maior
                    aiResponse = `**Escala Maior de ${tom} para Improvisa√ß√£o** üé∏\n\n**A Escala Maior Completa:**\nA escala maior √© a "m√£e" de todas as outras escalas e modos. Dominar esta escala abre portas para v√°rios estilos, do rock ao jazz, do pop ao cl√°ssico.\n\n**Padr√£o da Escala ${tom} Maior na Posi√ß√£o Aberta:**\n\n`;
                    
                    // Diferentes formatos dependendo do tom
                    if (tom === "C") {
                        aiResponse += ````
E |---0---1---3---|
B |---0---1---3---|
G |---0---2---|
D |---0---2---|
A |---0---2---3---|
E |---0---1---3---|
     Do  Re  Mi   Fa  Sol La  Si   Do
     1   2   3    4    5   6   7    1
````;
                    }
                    else if (tom === "G") {
                        aiResponse += ````
E |---3------|
B |---0---1---3---|
G |---0------|
D |---0---2---4---|
A |---2---3---5---|
E |---3------|
     Sol La  Si   Do  Re  Mi  Fa#  Sol
     1   2   3    4   5   6   7    1
````;
                    }
                    else {
                        aiResponse += ````
Para a escala de ${tom} Maior:
As notas s√£o: ${
                        {
                            "D": "R√©, Mi, F√°#, Sol, L√°, Si, D√≥#, R√©",
                            "A": "L√°, Si, D√≥#, R√©, Mi, F√°#, Sol#, L√°",
                            "E": "Mi, F√°#, Sol#, L√°, Si, D√≥#, R√©#, Mi"
                        }[tom] || `${tom}... (solicite um diagrama espec√≠fico para este tom)`
                        }

Graus:  1   2   3    4   5   6    7    1
````;
                    }
                    
            
            // Tuning
            else if (messageText.includes("afinar") || messageText.includes("afina√ß√£o")) {
                aiResponse = `Afina√ß√£o padr√£o do viol√£o (da mais grossa para a mais fina): **E - A - D - G - B - E** (Mi - L√° - R√© - Sol - Si - Mi).\n\n**Como Afinar:**\n1.  **Use um Afinador:** Pode ser um app no celular (como GuitarTuna, Cifra Club Afinador) ou um afinador f√≠sico.\n2.  **Comece pela 6¬™ Corda (E grave):** Toque a corda solta e ajuste a tarraxa at√© o afinador mostrar 'E' e ficar verde (ou indicar que est√° afinado).\n3.  **Repita para as Outras:** Fa√ßa o mesmo para A (5¬™), D (4¬™), G (3¬™), B (2¬™) e E (1¬™ aguda).\n4.  **Verifica√ß√£o:** Toque todas as cordas novamente para garantir que a tens√£o n√£o desafinou as outras.\n\n**Dica:** Afine sempre 'subindo' para a nota. Se passar, volte um pouco e suba novamente at√© o ponto certo. Isso ajuda a manter a afina√ß√£o mais est√°vel.`;
            }
        }

        // Fun√ß√£o para lidar com o envio de mensagem do usu√°rio
        async function handleSendMessage() {
            const message = userInput.value.trim();
            if (!message) return; // N√£o envia mensagens vazias
            
            // Adiciona a mensagem do usu√°rio ao chat
            addMessage(message, 'user');
            
            // Limpa o campo de entrada
            userInput.value = '';
            
            // Mostra indicador de carregamento
            showLoadingIndicator();
            
            setTimeout(() => {
                try {
                    // Usa apenas respostas locais (fallback) sem tentar acessar API externa
                    const response = getFallbackResponse(message);
                    
                    // Remove o indicador de carregamento
                    removeLoadingIndicator();
                    
                    // Adiciona a resposta ao chat
                    addMessage(response, 'ai');
                } catch (error) {
                    console.error('Erro ao processar resposta:', error);
                    removeLoadingIndicator();
                    addMessage('Desculpe, tive um problema ao processar sua pergunta. Pode tentar novamente?', 'ai');
                }
            }, 500); // Pequeno delay para simular processamento
        }

        // Adiciona eventos de clique e tecla Enter para enviar mensagem
        sendMessageBtn.addEventListener('click', handleSendMessage);
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleSendMessage();
            }
        });

        // Adicionar estilos para o indicador de carregamento
        const styleElement = document.createElement('style');
        styleElement.textContent = `
            .message.loading span {
                display: inline-flex;
                align-items: center;
                font-style: italic;
                color: var(--secondary-color);
            }
            .message.loading span::after {
                content: '';
                width: 12px;
                height: 12px;
                margin-left: 8px;
                border: 2px solid var(--border-color);
                border-radius: 50%;
                border-top-color: var(--primary-color);
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
            
            /* Adiciona informa√ß√£o sobre a IA no rodap√© */
            .ai-info {
                margin-top: 20px;
                font-size: 0.8rem;
                color: #E0E0E0; /* Lighter color for footer */
                text-align: center;
            }
            
            .ai-info a {
                color: var(--light-accent);
                text-decoration: none;
            }
            
            .ai-info a:hover {
                text-decoration: underline;
            }
        `;
        document.head.appendChild(styleElement);
        
        // Adiciona informa√ß√µes sobre a IA usada no rodap√©
        const aiInfoElement = document.createElement('p');
        aiInfoElement.className = 'ai-info';
        document.querySelector('footer .container').appendChild(aiInfoElement);

        // Populate suggested questions on load
        document.addEventListener('DOMContentLoaded', populateSuggestedQuestions);
    </script>
</body>
</html>
